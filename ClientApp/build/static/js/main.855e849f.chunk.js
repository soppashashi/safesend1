(this.webpackJsonpSafeSend_Outlook_WebAddIn=this.webpackJsonpSafeSend_Outlook_WebAddIn||[]).push([[0],{327:function(e,t,n){e.exports=n(548)},548:function(e,t,n){"use strict";n.r(t);n(174),n(191),n(203);var i,s,o,a,r,c,l,p,u,d,h,g=n(6),m=n.n(g),f=n(11),v=n(12),y=n(14),b=n(25),S=n(18),C=n(19),x=n(0),R=n(163),w=n(607),k=n(625),E=n(311),T=n(615),A=n(39),O=n(622),P=n(624),L=n(618),I=n(626),D=n(608),N=n(113),V=n(620),j=n(13),M=n(617),_=n(627),B=n(295),F=n(619),W=n(2);!function(e){e[e.Disabled=0]="Disabled",e[e.AskWhenFilesAreAttached=1]="AskWhenFilesAreAttached",e[e.AskWhenFoundSensitiveContent=2]="AskWhenFoundSensitiveContent",e[e.AlwaysAsk=3]="AlwaysAsk"}(i||(i={})),function(e){e[e.RequireUserInput=0]="RequireUserInput",e[e.Encrypt=1]="Encrypt",e[e.DoNotEncrypt=2]="DoNotEncrypt"}(s||(s={})),function(e){e.Valid="Valid",e.Invalid="Invalid",e.TrialExpired="TrialExpired",e.LicenseExpired="LicenseExpired"}(o||(o={})),function(e){e[e.Ignore=0]="Ignore",e[e.Notify=1]="Notify",e[e.Confirm=2]="Confirm",e[e.Deny=3]="Deny"}(a||(a={})),function(e){e[e.TO=0]="TO",e[e.CC=1]="CC",e[e.BCC=2]="BCC",e[e.Sender=3]="Sender"}(r||(r={})),function(e){e.ReceiveDlpItemResults="ReceiveDlpItemResults",e.ReceiveFinishingContenScanning="ReceiveFinishingContenScanning",e.ReceiveAttachmentPasswordRequest="ReceiveAttachmentPasswordRequest"}(c||(c={})),function(e){e.ReceiveGetAttachmentContent="ReceiveGetAttachmentContent"}(l||(l={})),function(e){e.Filename="Filename",e.Attachment="Attachment",e.Body="Body",e.Subject="Subject"}(p||(p={})),function(e){e.Confirm="Confirm",e.Inform="Inform",e.Deny="Deny",e.ConfirmText="ConfirmText"}(u||(u={})),function(e){e.Unsupported="Unsupported",e.Scanning="Scanning",e.Error="Error",e.ProtectedDocument="ProtectedDocument",e.PasswordProtected="PasswordProtected",e.SensitiveDataFound="SensitiveDataFound",e.Success="Success",e.Unknown="Unknown",e.ScanNotStarted="ScanNotStarted",e.ScanTimedOut="ScanTimedOut"}(d||(d={})),function(e){e.Unknown="Unknown",e.Mail="Mail",e.TaskRequest="TaskRequest",e.Meeting="Meeting"}(h||(h={}));var U=n(308),H=n(611),K=n(16),z=n(67);function G(e){return e.replace(/[?!]/g,"")}function q(e,t){var n=e.toString();if(n.startsWith("class ")&&!n.startsWith("class =>"))return G(n.substring("class ".length,n.indexOf(" {")));if(n.includes("=>"))return G(n.substring(n.indexOf(".")+1));var i=n.match(/function\s*\(\w+\)\s*\{[\r\n\s]*return\s+\w+\.((\w+\.)*(\w+))/i);if(i)return t&&t.lastProp?i[3]:i[1];if(n.startsWith("function "))return G(n.substring("function ".length,n.indexOf("(")));throw new Error("ts-simple-nameof: Invalid function.")}var J,Y,X,Z=function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return e.replace(/{(\d+)}/g,(function(e,t){return n[t]||""}))};function Q(e,t,n){var i=t.split(e),s='<a target="_blank" href="'.concat(n,'">');return i[0].concat(s).concat(i[1]).concat("</a>").concat(i[2])}function $(e){for(var t,n=new RegExp("color=(.+?)(?=>)","g"),i=[];null!==(t=n.exec(e));)i.push(t[0].replace("color=",""));return i.forEach((function(t){e=(e=t.includes(",")?e.replace("color="+t,'div style="color:rgb('+t+')"'):e.replace("color="+t,'div style="color:'+t+'"')).replace("/color","/div")})),e}!function(e){e.Safari="Safari",e.WebKit="WebKit"}(J||(J={})),function(e){e[e.DialogId=0]="DialogId",e[e.ApiResponse=1]="ApiResponse",e[e.SafeSendToken=2]="SafeSendToken",e[e.LoggedIn=3]="LoggedIn",e[e.OutlookAccessToken=4]="OutlookAccessToken"}(Y||(Y={})),function(e){e.AddinHub="/addinhub",e.UIHub="/uihub"}(X||(X={}));var ee,te=new(function(){function e(){Object(v.a)(this,e)}return Object(y.a)(e,[{key:"sessionExists",value:function(e){return null!==window.sessionStorage.getItem(Y[e])}},{key:"sessionGet",value:function(e){return window.sessionStorage.getItem(Y[e])}},{key:"sessionSet",value:function(e,t){window.sessionStorage.setItem(Y[e],t)}},{key:"sessionRemove",value:function(e){window.sessionStorage.removeItem(Y[e])}},{key:"sessionClear",value:function(){window.sessionStorage.clear()}},{key:"localExists",value:function(e){return null!==window.localStorage.getItem(Y[e])}},{key:"localGet",value:function(e){return window.localStorage.getItem(Y[e])}},{key:"localSet",value:function(e,t){window.localStorage.setItem(Y[e],t)}},{key:"localRemove",value:function(e){window.localStorage.removeItem(Y[e])}},{key:"localClear",value:function(){window.localStorage.clear()}}]),e}()),ne=n(614),ie=n(621),se=n(310),oe=n(628),ae=Object(W.C)({fileIconImg:{align:"middle",width:20,height:20,padding:"0px 4px 0px 4px"}}),re=function(e){Object(S.a)(n,e);var t=Object(C.a)(n);function n(e){var i;return Object(v.a)(this,n),(i=t.call(this,e)).state={stateUpdate:!1,checked:!1},i.handleChange=i.handleChange.bind(Object(b.a)(i)),i}return Object(y.a)(n,[{key:"handleChange",value:function(e){var t=(null===e||void 0===e?void 0:e.target).checked;this.setState({checked:t,stateUpdate:!0}),this.props.onChange(this.props.id,t)}},{key:"render",value:function(){return x.createElement(F.a,{reversed:this.props.alignRightToLeft,horizontal:!0,disableShrink:!0},this.props.showCheckBox&&x.createElement(F.a.Item,{align:"auto"},x.createElement(O.a,{disabled:this.props.disabled,onChange:this.handleChange,checked:this.state.checked})),null!==this.props.filename&&x.createElement(F.a.Item,{align:"auto"},x.createElement(se.a,Object.assign({className:ae.fileIconImg},Object(oe.a)({extension:this.props.filename.split(".").pop(),imageFileType:"svg"})))),x.createElement(F.a.Item,{align:"auto"},x.createElement(x.Fragment,null,x.createElement(ie.a,{variant:"smallPlus",nowrap:!0},this.props.filename))))}}],[{key:"getDerivedStateFromProps",value:function(e,t){return t.stateUpdate?{stateUpdate:!1}:e.checked!==t.checked?{checked:e.checked}:null}}]),n}(x.Component),ce=function(e){Object(S.a)(n,e);var t=Object(C.a)(n);function n(){return Object(v.a)(this,n),t.apply(this,arguments)}return Object(y.a)(n,[{key:"render",value:function(){var e,t,n=this;return x.createElement(x.Fragment,null,this.props.useTooltip&&x.createElement(ne.a,{tooltipProps:(e=this.props.files,t=this.props.alignRightToLeft,{onRenderContent:function(){return x.createElement(F.a,null,e.map((function(e,n){return x.createElement(re,{id:"".concat(n),key:n,filename:e,alignRightToLeft:t,showCheckBox:!1,checked:!1,disabled:!1,onChange:function(e){}})})))}})},"[".concat(this.props.pointCursorText,"]")),!this.props.useTooltip&&x.createElement(F.a,{horizontal:!0,horizontalAlign:this.props.alignRightToLeft?"end":"start"},this.props.files.map((function(e,t){return x.createElement(re,{id:"".concat(t),key:t,filename:e,alignRightToLeft:n.props.alignRightToLeft,showCheckBox:!1,checked:!1,disabled:!1,onChange:function(e){}})}))))}}]),n}(x.Component),le={root:{width:80,position:"relative",paddingLeft:"5px"}},pe={root:{height:"35px",paddingTop:"2px"}},ue=function(e){return e?x.createElement(U.a,Object.assign({},e,{styles:pe})):null},de={childrenGap:5},he={root:{border:"1px solid #ccc"}},ge={root:{paddingTop:"15px"}},me=function(e){var t=[{key:"column1",name:e.columnName1,fieldName:"".concat(q((function(e){return e.sourceTypeString}))),minWidth:80,maxWidth:80,isRowHeader:!0,isResizable:!0,data:"string",isPadded:!0,styles:{cellTitle:e.alignRightToLeft?{flexDirection:"row-reverse"}:{}},onRender:function(t){return x.createElement(F.a,{style:e.alignRightToLeft?{textAlign:"right"}:{textAlign:"left"}},t.sourceTypeString)}},{key:"column2",name:e.columnName2,fieldName:"".concat(q((function(e){return e.attachmentPath}))),minWidth:100,maxWidth:500,isRowHeader:!0,isResizable:!0,data:"string",isPadded:!0,styles:{cellTitle:e.alignRightToLeft?{flexDirection:"row-reverse"}:{}},onRender:function(t){return x.createElement(F.a,{style:e.alignRightToLeft?{alignItems:"flex-end"}:{alignItems:"flex-start"}},!t.groupBy&&(t.sourceType===p.Attachment||t.sourceType===p.Filename||t.sourceType===p.Body)&&x.createElement(re,{id:t.key,key:t.key,filename:t.attachmentPath,alignRightToLeft:e.alignRightToLeft,showCheckBox:!1,checked:!1,disabled:!1,onChange:function(e){}}),t.groupBy&&!t.tooLong&&x.createElement(ce,{pointCursorText:e.pointCursorText,files:t.files,alignRightToLeft:e.alignRightToLeft,useTooltip:t.useTooltip}),t.groupBy&&t.tooLong&&x.createElement("span",null,"[",e.tooLongText,"]"))}},{key:"column3",name:e.columnName3,fieldName:"".concat(q((function(e){return e.clientKeyword}))),minWidth:100,maxWidth:150,isRowHeader:!0,isResizable:!0,data:"string",isPadded:!0,styles:{cellTitle:e.alignRightToLeft?{flexDirection:"row-reverse"}:{}},onRender:function(t){return x.createElement(F.a,{style:e.alignRightToLeft?{textAlign:"right"}:{textAlign:"left"}},t.clientKeyword)}},{key:"column4",name:e.columnName4,fieldName:"".concat(q((function(e){return e.matchCount}))),minWidth:80,maxWidth:80,isRowHeader:!0,isResizable:!0,data:"string",isPadded:!0,styles:{cellTitle:e.alignRightToLeft?{flexDirection:"row-reverse"}:{}},onRender:function(t){return x.createElement(F.a,{style:e.alignRightToLeft?{textAlign:"right"}:{textAlign:"left"}},t.matchCount)}},{key:"column5",name:e.columnName5,fieldName:"".concat(q((function(e){return e.allowedDomain}))),minWidth:100,maxWidth:200,isRowHeader:!0,isResizable:!0,data:"string",isPadded:!0,styles:{cellTitle:e.alignRightToLeft?{flexDirection:"row-reverse"}:{}},onRender:function(t){return x.createElement(F.a,{style:e.alignRightToLeft?{textAlign:"right"}:{textAlign:"left"}},t.allowedDomain)}}];return e.hasAttachments&&e.results.some((function(e){return null!==e.attachmentPath}))||t.splice(1,1),x.createElement(x.Fragment,null,x.createElement(F.a,{styles:he},x.createElement(H.a,{items:e.results,columns:e.alignRightToLeft?t.reverse():t,compact:!0,checkboxVisibility:K.a.hidden,disableSelectionZone:!1,selectionMode:z.b.none,onRenderDetailsHeader:ue})),e.showTextField&&x.createElement(F.a,{horizontal:!0,reversed:e.alignRightToLeft,styles:ge,tokens:de},x.createElement(P.a,null,e.confirmText," "),x.createElement(M.a,{required:!0,autoComplete:"off",styles:le,disabled:e.denySend,onChange:e.onChangeAction})))},fe={root:{height:"35px",paddingTop:"2px"}},ve={root:{width:80,position:"relative",paddingLeft:"5px"}},ye={childrenGap:5},be={root:{paddingTop:"15px"}},Se={root:{border:"1px solid #ccc"}},Ce=function(e){return e?x.createElement(U.a,Object.assign({},e,{styles:fe})):null},xe=function(e){var t=[{key:"column1",name:e.columnName1,fieldName:"".concat(q((function(e){return e.ruleName}))),minWidth:80,maxWidth:80,isRowHeader:!0,isResizable:!0,data:"string",isPadded:!0,styles:{cellTitle:e.alignRightToLeft?{flexDirection:"row-reverse"}:{}},onRender:function(t){return x.createElement(F.a,{style:e.alignRightToLeft?{textAlign:"right"}:{textAlign:"left"}},t.ruleName)}},{key:"column2",name:e.columnName2,fieldName:"".concat(q((function(e){return e.sourceTypeString}))),minWidth:80,maxWidth:80,isRowHeader:!0,isResizable:!0,data:"string",isPadded:!0,styles:{cellTitle:e.alignRightToLeft?{flexDirection:"row-reverse"}:{}},onRender:function(t){return x.createElement(F.a,{style:e.alignRightToLeft?{textAlign:"right"}:{textAlign:"left"}},t.sourceTypeString)}},{key:"column3",name:e.columnName3,fieldName:"".concat(q((function(e){return e.attachmentPath}))),minWidth:100,maxWidth:500,isRowHeader:!0,isResizable:!0,data:"string",isPadded:!0,styles:{cellTitle:e.alignRightToLeft?{flexDirection:"row-reverse"}:{}},onRender:function(t){return x.createElement(F.a,{style:e.alignRightToLeft?{alignItems:"flex-end"}:{alignItems:"flex-start"}},!t.groupBy&&(t.sourceType===p.Attachment||t.sourceType===p.Filename||t.sourceType===p.Body)&&x.createElement(re,{id:t.key,key:t.key,filename:t.attachmentPath,alignRightToLeft:e.alignRightToLeft,showCheckBox:!1,checked:!1,disabled:!1,onChange:function(e){}}),t.groupBy&&!t.tooLong&&x.createElement(ce,{pointCursorText:e.pointCursorText,files:t.files,alignRightToLeft:e.alignRightToLeft,useTooltip:t.useTooltip}),t.groupBy&&t.tooLong&&x.createElement("span",null,"[",e.tooLongText,"]"))}},{key:"column4",name:e.columnName4,fieldName:"".concat(q((function(e){return e.firstMatch}))),minWidth:80,maxWidth:210,isRowHeader:!0,isResizable:!0,data:"string",isPadded:!0,styles:{cellTitle:e.alignRightToLeft?{flexDirection:"row-reverse"}:{}},onRender:function(t){return x.createElement(F.a,{style:e.alignRightToLeft?{textAlign:"right"}:{textAlign:"left"}},t.firstMatch)}},{key:"column5",name:e.columnName5,fieldName:"".concat(q((function(e){return e.matchCount}))),minWidth:80,maxWidth:80,isRowHeader:!0,isResizable:!0,data:"string",isPadded:!0,styles:{cellTitle:e.alignRightToLeft?{flexDirection:"row-reverse"}:{}},onRender:function(t){return x.createElement(F.a,{style:e.alignRightToLeft?{textAlign:"right"}:{textAlign:"left"}},t.matchCount)}}];return e.hasAttachments&&e.results.some((function(e){return null!==e.attachmentPath}))||t.splice(2,1),x.createElement(x.Fragment,null,x.createElement(F.a,{styles:Se},x.createElement(H.a,{columns:e.alignRightToLeft?t.reverse():t,items:e.results,compact:!0,checkboxVisibility:K.a.hidden,disableSelectionZone:!1,selectionMode:z.b.none,onRenderDetailsHeader:Ce})),e.showTextField&&x.createElement(F.a,{horizontal:!0,reversed:e.alignRightToLeft,styles:be,tokens:ye},x.createElement(P.a,null,e.labelTextField," "),x.createElement(M.a,{required:!0,styles:ve,autoComplete:"off",disabled:e.denySend,onChange:e.onChangeTextField})),e.showCheckbox&&x.createElement(F.a,{style:e.alignRightToLeft?{alignItems:"flex-end"}:{alignItems:"flex-start"}},x.createElement(O.a,{boxSide:e.alignRightToLeft?"end":"start",styles:be,label:e.labelCheckbox,checked:e.checkboxChecked,disabled:e.denySend,onChange:e.onChangeCheckbox})))},Re=n(623),we=n(77),ke=n(632),Ee={padding:"".concat(0,"px ",0,"px ",5,"px ",0,"px")},Te=function(e){Object(S.a)(n,e);var t=Object(C.a)(n);function n(e){var i;return Object(v.a)(this,n),(i=t.call(this,e)).state={stateUpdate:!1,checked:!1},i.handleChange=i.handleChange.bind(Object(b.a)(i)),i}return Object(y.a)(n,[{key:"handleChange",value:function(e){var t=(null===e||void 0===e?void 0:e.target).checked;this.setState({checked:t,stateUpdate:!0}),this.props.onChange(this.props.id,t)}},{key:"render",value:function(){return x.createElement(F.a,{reversed:this.props.alignRightToLeft,horizontal:!0,tokens:Ee,verticalAlign:"center"},this.props.showCheckBox&&x.createElement(O.a,{disabled:this.props.disabled,onChange:this.handleChange,checked:this.state.checked}),this.props.colorDomains&&x.createElement(P.a,{styles:{root:{color:this.props.color}}}," ",this.props.text," "),!this.props.colorDomains&&x.createElement(P.a,null," ",this.props.text," "))}}],[{key:"getDerivedStateFromProps",value:function(e,t){return t.stateUpdate?{stateUpdate:!1}:e.checked!==t.checked?{checked:e.checked}:null}}]),n}(x.Component),Ae={padding:"".concat(0,"px ",0,"px ",0,"px ",54,"px")},Oe={padding:"".concat(0,"px ",47,"px ",0,"px ",0,"px")},Pe=function(e){Object(S.a)(n,e);var t=Object(C.a)(n);function n(e){var i;return Object(v.a)(this,n),(i=t.call(this,e)).state={stateUpdate:!1,checked:!1,toggle:e.expanded},i.handleChange=i.handleChange.bind(Object(b.a)(i)),i.handleToggle=i.handleToggle.bind(Object(b.a)(i)),i.handleChangePersonaConfirmable=i.handleChangePersonaConfirmable.bind(Object(b.a)(i)),i}return Object(y.a)(n,[{key:"handleToggle",value:function(e){this.setState({toggle:!this.state.toggle})}},{key:"handleChange",value:function(e){var t=(null===e||void 0===e?void 0:e.target).checked;this.setState({checked:t,stateUpdate:!0}),this.props.onChange(this.props.id,t)}},{key:"handleChangePersonaConfirmable",value:function(e,t){this.setState({checked:t,stateUpdate:!0}),this.props.onChange(e,t)}},{key:"render",value:function(){var e=this;return x.createElement(x.Fragment,null,this.props.single&&x.createElement(Te,{onChange:this.handleChangePersonaConfirmable,disabled:this.props.disabled,checked:this.state.checked,key:this.props.id,id:this.props.id,showCheckBox:!0,text:this.props.text,colorDomains:this.props.colorDomains,color:this.props.color,alignRightToLeft:this.props.alignRightToLeft}),!this.props.single&&x.createElement(F.a,null,x.createElement(F.a,{reversed:this.props.alignRightToLeft,horizontal:!0,wrap:!0},x.createElement(F.a.Item,{align:"center"},x.createElement(O.a,{disabled:this.props.disabled,onChange:this.handleChange,checked:this.state.checked})),x.createElement(F.a.Item,{align:"center"},!this.state.toggle&&x.createElement(ke.a,{onClick:this.handleToggle,iconProps:{iconName:"ChevronDown"},title:"",ariaLabel:"Down"}),this.state.toggle&&x.createElement(ke.a,{onClick:this.handleToggle,iconProps:{iconName:"ChevronUp"},title:"",ariaLabel:"Up"})),x.createElement(F.a.Item,{align:"center"},x.createElement(P.a,null,"@",this.props.text))),this.state.toggle&&x.createElement(F.a,{horizontal:!0,reversed:this.props.alignRightToLeft,wrap:!0,tokens:this.props.alignRightToLeft?Oe:Ae},x.createElement(F.a,null,this.props.colorDomains&&this.props.recipients.map((function(t){return x.createElement(P.a,{styles:{root:{color:e.props.color}}}," ",t.displayName," ")})),!this.props.colorDomains&&this.props.recipients.map((function(e){return x.createElement(P.a,null," ",e.displayName," ")}))))))}}],[{key:"getDerivedStateFromProps",value:function(e,t){return t.stateUpdate?{stateUpdate:!1}:e.checked!==t.checked?{checked:e.checked}:null}}]),n}(x.Component);!function(e){e[e.SafeSend_Index=0]="SafeSend_Index",e[e.SafeSend_App=1]="SafeSend_App",e[e.SafeSend_ConfirmableList=2]="SafeSend_ConfirmableList",e[e.SafeSend_OfficeDialog=3]="SafeSend_OfficeDialog",e[e.SafeSend_AddIn=4]="SafeSend_AddIn"}(ee||(ee={}));var Le,Ie=n(300),De=n(83);!function(e){e.TRACE="TRACE",e.DEBUG="DEBUG",e.INFO="INFO",e.WARN="WARN",e.ERROR="ERROR"}(Le||(Le={}));var Ne=new(function(e){Object(S.a)(n,e);var t=Object(C.a)(n);function n(){var e;Object(v.a)(this,n);for(var i=arguments.length,s=new Array(i),o=0;o<i;o++)s[o]=arguments[o];return(e=t.call.apply(t,[this].concat(s))).options={minLevels:{}},e.consoleLoggerRegistered=!1,e}return Object(y.a)(n,[{key:"configure",value:function(e){return this.options=Object.assign(this.options,e),this}},{key:"getLogger",value:function(e){var t="none",n="";for(var i in this.options.minLevels)e.startsWith(i)&&i.length>=n.length&&(t=this.options.minLevels[i],n=i);return new Ve(this,e,t)}},{key:"onLogEntry",value:function(e){return this.on("log",e),this}},{key:"registerConsoleLogger",value:function(){return this.consoleLoggerRegistered||(this.onLogEntry((function(e){var t="[".concat((new Date).toLocaleString(),"] [").concat(e.level,"] [").concat(e.module,"] ").concat(e.message," [").concat(e.location,"]");switch(e.level){case Le.TRACE:console.trace(t);break;case Le.DEBUG:console.debug(t);break;case Le.INFO:console.info(t);break;case Le.WARN:console.warn(t);break;case Le.ERROR:console.error(t);break;default:console.log("{".concat(e.level,"} ").concat(t))}})),this.consoleLoggerRegistered=!0),this}}]),n}(Ie.EventEmitter)),Ve=function(){function e(t,n,i){Object(v.a)(this,e),this.logManager=void 0,this.minLevel=void 0,this.module=void 0,this.levels={trace:1,debug:2,info:3,warn:4,error:5},this.logManager=t,this.module=n,this.minLevel=this.levelToInt(i)}return Object(y.a)(e,[{key:"levelToInt",value:function(e){return e.toLowerCase()in this.levels?this.levels[e.toLowerCase()]:99}},{key:"log",value:function(e,t){if(!(this.levelToInt(e)<this.minLevel)){var n={level:e,module:this.module,message:t},i=new Error("");if(i.stack){for(var s=i.stack.split("\n"),o=1;o<s.length&&s[o].includes("at Logger.");)o++;o<s.length&&(n.location=s[o].slice(s[o].indexOf("at ")+3,s[o].length))}this.logManager.emit("log",n)}}},{key:"trace",value:function(e){this.log(Le.TRACE,e)}},{key:"debug",value:function(e){this.log(Le.DEBUG,e)}},{key:"info",value:function(e){this.log(Le.INFO,e)}},{key:"warn",value:function(e){this.log(Le.WARN,e)}},{key:"error",value:function(e){this.log(Le.ERROR,e)}}]),e}(),je=new(function(){function e(){Object(v.a)(this,e)}return Object(y.a)(e,[{key:"getMinLevels",value:function(){var e={},t=De.logLevel;for(var n in ee)e[ee[n]]=t;return e}},{key:"getLogger",value:function(e){return Ne.configure({minLevels:this.getMinLevels()}).registerConsoleLogger(),Ne.getLogger(ee[e])}}]),e}()),Me=je.getLogger(ee.SafeSend_ConfirmableList),_e={padding:"".concat(0,"px ",30,"px ",0,"px ",30,"px")},Be={padding:"".concat(0,"px ",24,"px ",0,"px ",28,"px")},Fe=Object(W.D)({padding:0,fontSize:"16px",verticalAlign:"middle",maxHeight:"16px",maxWidth:"16px"}),We=["#69797E","#A4262C","#004E8C","#0B6A0B","#986F0B"],Ue={},He=Object(W.C)({error:[{color:"red",cursor:"default"},Fe],warning:[{color:"#ffc107",cursor:"default"},Fe],info:[{color:"#6c757d",cursor:"default"},Fe],completed:[{color:"green",cursor:"default"},Fe]}),Ke=function(e){Object(S.a)(n,e);var t=Object(C.a)(n);function n(e){var i;return Object(v.a)(this,n),(i=t.call(this,e)).state={toConfirmableList:[],ccConfirmableList:[],bccConfirmableList:[],attachmentConfirmableList:[],allChecked:!1,checked:!1,updatedDlpstatus:!1},i.handleChangeSelectAll=i.handleChangeSelectAll.bind(Object(b.a)(i)),i.handleChangeConfirmable=i.handleChangeConfirmable.bind(Object(b.a)(i)),i}return Object(y.a)(n,[{key:"handleChangeSelectAll",value:function(){var e=Object(f.a)(m.a.mark((function e(t){var n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=(null===t||void 0===t?void 0:t.target).checked,this.state.toConfirmableList.forEach((function(e){e.checked=n})),this.state.ccConfirmableList.forEach((function(e){e.checked=n})),this.state.bccConfirmableList.forEach((function(e){e.checked=n})),this.state.attachmentConfirmableList.forEach((function(e){e.checked=n})),e.next=7,this.setState({allChecked:n,checked:n,toConfirmableList:this.state.toConfirmableList,ccConfirmableList:this.state.ccConfirmableList,bccConfirmableList:this.state.bccConfirmableList,attachmentConfirmableList:this.state.attachmentConfirmableList});case 7:this.props.onChange(this.state.allChecked);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleChangeConfirmable",value:function(){var e=Object(f.a)(m.a.mark((function e(t,n){var i,s;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=!1,(i=this.state.toConfirmableList.every((function(e){return e.id!==t||(e.checked=n,!1)})))&&(i=this.state.ccConfirmableList.every((function(e){return e.id!==t||(e.checked=n,!1)}))),i&&(i=this.state.bccConfirmableList.every((function(e){return e.id!==t||(e.checked=n,!1)}))),i&&this.state.attachmentConfirmableList.every((function(e){return e.id!==t||(e.checked=n,!1)})),(s=this.state.toConfirmableList.every((function(e){return e.checked})))&&(s=this.state.ccConfirmableList.every((function(e){return e.checked})))&&(s=this.state.bccConfirmableList.every((function(e){return e.checked})))&&(s=this.state.attachmentConfirmableList.every((function(e){return e.checked}))),e.next=9,this.setState({allChecked:s,checked:s,toConfirmableList:this.state.toConfirmableList,ccConfirmableList:this.state.ccConfirmableList,bccConfirmableList:this.state.bccConfirmableList,attachmentConfirmableList:this.state.attachmentConfirmableList});case 9:this.props.onChange(this.state.allChecked);case 10:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e,t,n,i,s,o,a,r,c=this;return x.createElement(F.a,{style:this.props.alignRightToLeft?{alignItems:"flex-end"}:{alignItems:"flex-start"}},!(null===(e=this.props.apiResponse.onSendProcessContex)||void 0===e?void 0:e.settings._disableSelectAll)&&(this.props.apiResponse.unsafeRecipientsCount>1||this.props.apiResponse.unsafeAttachmentsCount>0)&&this.props.apiResponse.unsafeRecipientsCount+this.props.apiResponse.unsafeAttachmentsCount>=(null===(t=this.props.apiResponse.onSendProcessContex)||void 0===t?void 0:t.settings._disableSelectAllForLessThanXCheckboxes)&&x.createElement(O.a,{boxSide:this.props.alignRightToLeft?"end":"start",disabled:this.props.denySend,label:null===(n=this.props.apiResponse.onSendProcessContex)||void 0===n?void 0:n.settings._stringMainSelectAll,checked:this.state.checked,onChange:this.handleChangeSelectAll}),x.createElement(F.a,{style:this.props.alignRightToLeft?{alignItems:"flex-end",width:"100%"}:{alignItems:"flex-start",width:"100%"}},this.state.toConfirmableList.length>0&&x.createElement(x.Fragment,null,x.createElement(P.a,null,null===(i=this.props.apiResponse.onSendProcessContex)||void 0===i?void 0:i.settings._stringMainEmailTO),x.createElement(F.a,{wrap:!0,tokens:_e},this.state.toConfirmableList.map((function(e){var t;return x.createElement(Pe,{onChange:c.handleChangeConfirmable,disabled:c.props.denySend,checked:e.checked,id:e.id,key:e.id,text:e.displayName,single:e.single,recipients:e.childrens,color:e.color,colorDomains:null===(t=c.props.apiResponse.onSendProcessContex)||void 0===t?void 0:t.confirmationFlags.colorDomains,alignRightToLeft:c.props.alignRightToLeft,expanded:c.props.apiResponse.onSendProcessContex.settings._expandListsByDefault})})))),this.state.ccConfirmableList.length>0&&x.createElement(x.Fragment,null,x.createElement(P.a,null,null===(s=this.props.apiResponse.onSendProcessContex)||void 0===s?void 0:s.settings._stringMainEmailCC),x.createElement(F.a,{wrap:!0,tokens:_e},this.state.ccConfirmableList.map((function(e){var t;return x.createElement(Pe,{onChange:c.handleChangeConfirmable,disabled:c.props.denySend,checked:e.checked,id:e.id,key:e.id,text:e.displayName,single:e.single,recipients:e.childrens,color:e.color,colorDomains:null===(t=c.props.apiResponse.onSendProcessContex)||void 0===t?void 0:t.confirmationFlags.colorDomains,alignRightToLeft:c.props.alignRightToLeft,expanded:c.props.apiResponse.onSendProcessContex.settings._expandListsByDefault})})))),this.state.bccConfirmableList.length>0&&x.createElement(x.Fragment,null,x.createElement(P.a,null,null===(o=this.props.apiResponse.onSendProcessContex)||void 0===o?void 0:o.settings._stringMainEmailBCC),x.createElement(F.a,{wrap:!0,tokens:_e},this.state.bccConfirmableList.map((function(e){var t;return x.createElement(Pe,{onChange:c.handleChangeConfirmable,disabled:c.props.denySend,checked:e.checked,id:e.id,key:e.id,text:e.displayName,single:e.single,recipients:e.childrens,color:e.color,colorDomains:null===(t=c.props.apiResponse.onSendProcessContex)||void 0===t?void 0:t.confirmationFlags.colorDomains,alignRightToLeft:c.props.alignRightToLeft,expanded:c.props.apiResponse.onSendProcessContex.settings._expandListsByDefault})})))),this.state.attachmentConfirmableList.length>0&&x.createElement(x.Fragment,null,(null===(a=this.props.apiResponse.onSendProcessContex)||void 0===a?void 0:a.settings._showAttachmentsSeparator)&&x.createElement(k.a,{styles:{root:{width:"100%"}}}),x.createElement(P.a,null,null===(r=this.props.apiResponse.onSendProcessContex)||void 0===r?void 0:r.settings._stringMainFilesAttachedHeader),x.createElement(F.a,{wrap:!0,tokens:Be},x.createElement("table",null,x.createElement("thead",null,x.createElement("tr",null,x.createElement("th",null),x.createElement("th",null),x.createElement("th",{className:"absorbing-column"}))),x.createElement("tbody",null,this.state.attachmentConfirmableList.map((function(e){return x.createElement("tr",{key:e.id},!c.props.alignRightToLeft&&x.createElement("td",null,x.createElement(re,{showCheckBox:!0,disabled:c.props.denySend,onChange:c.handleChangeConfirmable,checked:e.checked,id:e.id,key:e.id,filename:e.displayName,alignRightToLeft:c.props.alignRightToLeft})),x.createElement("td",null,e.dlp.status===d.Unsupported&&x.createElement(ne.a,{content:e.dlp.statusString},x.createElement(B.a,{iconName:"Info",className:He.info})),e.dlp.status===d.Scanning&&!c.props.scanTimedOut&&x.createElement(ne.a,{content:e.dlp.statusString},x.createElement(Re.a,{type:we.b.normal})),e.dlp.status===d.Scanning&&c.props.scanTimedOut&&x.createElement(ne.a,{content:e.dlp.statusString},x.createElement(B.a,{iconName:"Warning",className:He.warning})),e.dlp.status===d.Error&&x.createElement(ne.a,{content:e.dlp.statusString},x.createElement(B.a,{iconName:"FileBug",className:He.error})),e.dlp.status===d.PasswordProtected&&x.createElement(ne.a,{content:e.dlp.statusString},x.createElement(B.a,{iconName:"ProtectRestrict",className:He.info})),e.dlp.status===d.ProtectedDocument&&x.createElement(ne.a,{content:e.dlp.statusString},x.createElement(B.a,{iconName:"ProtectedDocument",className:He.info})),e.dlp.status===d.SensitiveDataFound&&x.createElement(ne.a,{content:e.dlp.statusString},x.createElement(B.a,{iconName:"ReportWarning",className:He.error})),e.dlp.status===d.Success&&x.createElement(ne.a,{content:e.dlp.statusString},x.createElement(B.a,{iconName:"Completed",className:He.completed}))),c.props.alignRightToLeft&&x.createElement("td",null,x.createElement(re,{showCheckBox:!0,disabled:c.props.denySend,onChange:c.handleChangeConfirmable,checked:e.checked,id:e.id,key:e.id,filename:e.displayName,alignRightToLeft:c.props.alignRightToLeft})),!c.props.alignRightToLeft&&x.createElement("td",null))}))))))))}}],[{key:"getDerivedStateFromProps",value:function(e,t){if(t.updatedDlpstatus)return{updatedDlpstatus:!1};if(e.dlps.length>0&&!t.updatedDlpstatus)return Me.debug("Fill from DLP items"),e.dlps.forEach((function(e){t.attachmentConfirmableList.every((function(t){return t.dlp.id!==e.id||(t.dlp.status=e.status,t.dlp.statusString=e.statusString,!1)}))})),{attachmentConfirmableList:t.attachmentConfirmableList,updatedDlpstatus:!0};if(Object.keys(e.apiResponse).length>0&&0===t.toConfirmableList.length&&0===t.ccConfirmableList.length&&0===t.bccConfirmableList.length){var n,i,s,o,a,r,c;Me.debug("Fill from API response");var l=e.apiResponse.onSendProcessContex.settings._precheckRecipients,p=0,u=null===(n=e.apiResponse.unsafeRecipients)||void 0===n?void 0:n.to.map((function(e){return Ue[e.domain]||(Ue[e.domain]=We[p],++p>=We.length&&(p-=We.length)),{id:e.id,single:!0,checked:l,displayName:e.displayName,color:Ue[e.domain],childrens:[]}})),h=null===(i=e.apiResponse.unsafeRecipients)||void 0===i?void 0:i.cc.map((function(e){return Ue[e.domain]||(Ue[e.domain]=We[p],++p>=We.length&&(p-=We.length)),{id:e.id,single:!0,checked:l,displayName:e.displayName,color:Ue[e.domain],childrens:[]}})),g=null===(s=e.apiResponse.unsafeRecipients)||void 0===s?void 0:s.bcc.map((function(e){return Ue[e.domain]||(Ue[e.domain]=We[p],++p>=We.length&&(p-=We.length)),{id:e.id,single:!0,checked:l,displayName:e.displayName,color:Ue[e.domain],childrens:[]}})),m=0,f=null===(o=e.apiResponse.unsafeRecipients)||void 0===o?void 0:o.toGroup.map((function(e){return++m>=We.length&&(m-=We.length),{id:e.id,single:!1,checked:l,displayName:e.domain,color:We[m],childrens:e.recipients.map((function(e){return{id:e.id,displayName:e.displayName}}))}})),v=null===(a=e.apiResponse.unsafeRecipients)||void 0===a?void 0:a.ccGroup.map((function(e){return++m>=We.length&&(m-=We.length),{id:e.id,single:!1,checked:l,displayName:e.domain,color:We[m],childrens:e.recipients.map((function(e){return{id:e.id,displayName:e.displayName}}))}})),y=null===(r=e.apiResponse.unsafeRecipients)||void 0===r?void 0:r.bccGroup.map((function(e){return++m>=We.length&&(m-=We.length),{id:e.id,single:!1,checked:l,displayName:e.domain,color:We[m],childrens:e.recipients.map((function(e){return{id:e.id,displayName:e.displayName}}))}})),b=e.apiResponse.onSendProcessContex.settings,S=null===(c=e.apiResponse.unsafeAttachments)||void 0===c?void 0:c.map((function(t){return{id:t.id,checked:l,displayName:t.filename,dlp:{id:t.id,status:e.apiResponse.onSendProcessContex.scanStarted?"none"===t.contentType?d.Unsupported:d.Scanning:d.ScanNotStarted,statusString:e.apiResponse.onSendProcessContex.scanStarted?"none"===t.contentType?b._stringAttachmentStatusUnsupported:b._stringAttachmentStatusScanning:b._stringAttachmentStatusScanNotStarted}}}));return e.onChange(l),{allChecked:l,checked:l,toConfirmableList:u.concat(f),ccConfirmableList:h.concat(v),bccConfirmableList:g.concat(y),attachmentConfirmableList:S}}return null}}]),n}(x.Component),ze=n(41),Ge=n(208),qe=n(70),Je=n.n(qe),Ye=n(301),Xe=je.getLogger(ee.SafeSend_App);Object(Ye.a)(Je.a,{retries:De.retryOptions.retries,retryDelay:function(e,t){return Xe.error("Retry attempt: (".concat(e," of ").concat(De.retryOptions.retries,"), Error Found: ").concat(t.message)),De.retryOptions.retryDelay},retryCondition:function(){var e=Object(f.a)(m.a.mark((function e(t){var n,i,s;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(401!==(null===(n=t.response)||void 0===n?void 0:n.status)){e.next=2;break}return e.abrupt("return",!1);case 2:if(200!==De.retryOptions.retryErrorCode){e.next=6;break}return e.abrupt("return",(null===(i=t.response)||void 0===i?void 0:i.status)!==De.retryOptions.retryErrorCode);case 6:return e.abrupt("return",(null===(s=t.response)||void 0===s?void 0:s.status)===De.retryOptions.retryErrorCode);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()});var Ze,Qe=new(function(){function e(){var t=this;Object(v.a)(this,e),this.login=function(){var e=Object(f.a)(m.a.mark((function e(n){var i,s;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i={outlookToken:n},e.prev=1,e.next=4,Je.a.post("/api/login/",{},{headers:i});case 4:return s=e.sent,e.abrupt("return",t.getApiResponse(s.status,s.data));case 8:throw e.prev=8,e.t0=e.catch(1),t.getApiResponseError(e.t0);case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(t){return e.apply(this,arguments)}}(),this.getPlatformInfo=function(){var e=Object(f.a)(m.a.mark((function e(n){var i;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Je.a.get("api/settings/platform/".concat(n));case 3:return i=e.sent,e.abrupt("return",t.getApiResponse(i.status,i.data));case 7:throw e.prev=7,e.t0=e.catch(0),t.getApiResponseError(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}(),this.processMail=function(){var e=Object(f.a)(m.a.mark((function e(n,i){var s;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Je.a.post("/api/mail",i,t.getHeaders(n));case 3:return s=e.sent,e.abrupt("return",t.getApiResponse(s.status,s.data));case 7:throw e.prev=7,e.t0=e.catch(0),t.getApiResponseError(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),this.cancelDlp=function(){var e=Object(f.a)(m.a.mark((function e(n){var i;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Je.a.delete("/api/mail/dlp",t.getHeaders(n));case 3:return i=e.sent,e.abrupt("return",t.getApiResponse(i.status,!0));case 7:throw e.prev=7,e.t0=e.catch(0),t.getApiResponseError(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}(),this.postProcess=function(){var e=Object(f.a)(m.a.mark((function e(n,i){var s;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Je.a.patch("/api/mail",i,t.getHeaders(n));case 3:return s=e.sent,e.abrupt("return",t.getApiResponse(s.status,s.data));case 7:throw e.prev=7,e.t0=e.catch(0),t.getApiResponseError(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),this.sendAttachmentPassword=function(){var e=Object(f.a)(m.a.mark((function e(n,i){var s;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Je.a.patch("/api/mail/dlp/attachments",{password:i},t.getHeaders(n));case 3:return s=e.sent,e.abrupt("return",t.getApiResponse(s.status,!0));case 7:throw e.prev=7,e.t0=e.catch(0),t.getApiResponseError(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),this.sendAttachmentContent=function(){var e=Object(f.a)(m.a.mark((function e(n,i){var s;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Je.a.patch("/api/mail/dlp/attachment",i,t.getHeaders(n));case 3:return s=e.sent,e.abrupt("return",t.getApiResponse(s.status,!0));case 7:throw e.prev=7,e.t0=e.catch(0),t.getApiResponseError(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n){return e.apply(this,arguments)}}(),this.getAppInfo=Object(f.a)(m.a.mark((function e(){var n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Je.a.get("/api/settings/version");case 3:return n=e.sent,e.abrupt("return",t.getApiResponse(n.status,n.data));case 7:throw e.prev=7,e.t0=e.catch(0),t.getApiResponseError(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])}))),this.getAppSettings=function(){var e=Object(f.a)(m.a.mark((function e(n){var i;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Je.a.get("/api/settings",t.getHeaders(n));case 3:return i=e.sent,e.abrupt("return",t.getApiResponse(i.status,i.data));case 7:throw e.prev=7,e.t0=e.catch(0),t.getApiResponseError(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}()}return Object(y.a)(e,[{key:"getHeaders",value:function(e){return{headers:{authorization:"Bearer ".concat(e)}}}},{key:"getApiResponse",value:function(e,t){return{statusCode:e,content:t,errorMessage:"",errorContent:{},isSuccessStatusCode:200===e}}},{key:"getApiResponseError",value:function(e){var t;return 401===(null===(t=e.response)||void 0===t?void 0:t.status)?new et(e.message,e.response):new $e(e.message,e.response)}}]),e}()),$e=function(e){Object(S.a)(n,e);var t=Object(C.a)(n);function n(e){var i,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return Object(v.a)(this,n),(i=t.call(this,e)).response=void 0,i.message=e,i.name="ConnectionError",i.response=s,i}return n}(Object(Ge.a)(Error)),et=function(e){Object(S.a)(n,e);var t=Object(C.a)(n);function n(e){var i,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return Object(v.a)(this,n),(i=t.call(this,e)).response=void 0,i.message=e,i.name="UnauthorizedError",i.response=s,i}return n}(Object(Ge.a)(Error)),tt=Object(W.D)({padding:0,fontSize:"48px",verticalAlign:"middle",maxHeight:"48px",maxWidth:"48px"}),nt=Object(W.C)({box:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},info:[{color:"#6c757d",cursor:"default"},tt]}),it=function(e){Object(S.a)(n,e);var t=Object(C.a)(n);function n(){return Object(v.a)(this,n),t.apply(this,arguments)}return Object(y.a)(n,[{key:"render",value:function(){return x.createElement(F.a,{className:nt.box},x.createElement(B.a,{iconName:"PlugDisconnected",className:nt.info}),x.createElement(P.a,null,"Lost connection: To continue, close this window and refresh the browser (F5)."),x.createElement(ie.a,{variant:"small",block:!0},ze.osName," ",ze.osVersion," - ",ze.browserName," ",ze.fullBrowserVersion," - ",ze.engineName," ",ze.engineVersion))}}]),n}(x.Component),st=je.getLogger(ee.SafeSend_OfficeDialog),ot={root:{position:"relative",paddingLeft:"5px"}},at={root:{paddingTop:"15px"}},rt={childrenGap:5},ct={childrenGap:5,padding:5},lt={content:{flexDirection:"row-reverse",textAlign:"right"},innerText:{width:"100%"}},pt={padding:20},ut=Object(W.D)({padding:"0px 0px 0px 5px",fontSize:"20px",verticalAlign:"middle",maxHeight:"20px",maxWidth:"20px"}),dt=Object(W.C)({wrapper:{height:"100%",position:"relative",maxHeight:"inherit"},pane:{maxWidth:"100%",border:"1px solid #ccc"},sticky:{border:"1px solid #ccc",padding:"1px 0px 1px 0px",fontSize:"13px"},textContent:{padding:"15px 10px"},content:{height:"100%"},progressIndicator:{width:"100%"},notificationArea:{display:"flex"},error:[{color:"red",cursor:"default"},ut],warning:[{color:"#ffc107",cursor:"default"},ut],info:[{color:"#6c757d",cursor:"default"},ut],completed:[{color:"green",cursor:"default"},ut]}),ht={childrenGap:5,padding:"5px 0px 0px 0px"},gt={root:dt.pane},mt={content:{height:"100%",minHeight:"100%",padding:"0px 20px 0px 20px",margin:"0px"},header:{padding:"0px 0px 10px 19px",margin:"0px"}},ft=function(e){Object(S.a)(n,e);var t=Object(C.a)(n);function n(e,i){var s;return Object(v.a)(this,n),(s=t.call(this,e,i)).settings=void 0,s.mailboxItem=void 0,s.sendEvent=void 0,s.state={isConnectionLost:!1,enabledSend:!1,defaultValuesSettingUp:!1,showAttachmentPasswordPrompt:!1,hasShownPassowrdPrompt:!1,enabledSubmitPassword:!1},s.settings={confirmableAllSelected:!1,bccWarningIfMoreThanX:!1,showConfirmContentScanningText:!1,confirmContentScanningText:"",showConfirmContentScanningCheck:!1,confirmContentScanningCheck:!1,showConfirmClientKeywordsText:!1,confirmClientKeywordsText:"",denySend:!1,encryptNoSelected:!1,encryptYesSelected:!1,showEncryptPrompt:!1,attachmentPassword:"",confirmUnprotectedAttachmentsCheck:!1},s.closeDialog=s.closeDialog.bind(Object(b.a)(s)),s.attachmentPasswordRequest=s.attachmentPasswordRequest.bind(Object(b.a)(s)),s.attachmentSendPassword=s.attachmentSendPassword.bind(Object(b.a)(s)),s.setSendEnabled=s.setSendEnabled.bind(Object(b.a)(s)),s.isBccWarningVisible=s.isBccWarningVisible.bind(Object(b.a)(s)),s.isEncryptVisible=s.isEncryptVisible.bind(Object(b.a)(s)),s.setEncryptVisibility=s.setEncryptVisibility.bind(Object(b.a)(s)),s.isProcessMaxNrRecipients=s.isProcessMaxNrRecipients.bind(Object(b.a)(s)),s.validateEncryptionSelection=s.validateEncryptionSelection.bind(Object(b.a)(s)),s}return Object(y.a)(n,[{key:"componentDidMount",value:function(){var e=this;this.setDialogTimeout(240),this.props.onRef(this),window.addEventListener("storage",(function(){var t=te.localGet(Y.DialogId);e.props.dialogId!==t&&(st.warn("Dialog connection lost"),e.setState({isConnectionLost:!0}))}))}},{key:"componentWillUnmount",value:function(){this.props.onRef(void 0)}},{key:"closeDialog",value:function(e){Office.context.ui.messageParent(JSON.stringify(e))}},{key:"isBccWarningVisible",value:function(){return this.props.apiResponseView.onSendProcessContex.confirmationFlags.showBccWarning}},{key:"isEncryptVisible",value:function(){return this.settings.showEncryptPrompt}},{key:"setEncryptVisibility",value:function(e){this.settings.showEncryptPrompt=e}},{key:"validateEncryptionSelection",value:function(e,t){return!this.state.defaultValuesSettingUp&&t&&this.setState({defaultValuesSettingUp:!0}),this.state.defaultValuesSettingUp&&t||("Yes"===e?(this.settings.encryptYesSelected=!0,this.settings.encryptNoSelected=!1):"No"===e&&(this.settings.encryptNoSelected=!0,this.settings.encryptYesSelected=!1),this.setSendEnabled()),e}},{key:"isUnprotectedAttachmentsNotificationVisible",value:function(){return this.props.countUnprotectedAttachments>0&&(this.props.apiResponseView.onSendProcessContex.settings._unprotectedAttachmentsMode===a.Notify||this.props.apiResponseView.onSendProcessContex.settings._unprotectedAttachmentsMode===a.Deny)}},{key:"isUnprotectedAttachmentsComfirmationVisible",value:function(){return this.props.countUnprotectedAttachments>0&&this.props.apiResponseView.onSendProcessContex.settings._unprotectedAttachmentsMode===a.Confirm}},{key:"isPasswordPromptVisible",value:function(){return this.props.isDlpWaiting&&(this.props.apiResponseView.attachmentPasswordRequested&&!this.state.hasShownPassowrdPrompt||this.state.showAttachmentPasswordPrompt)}},{key:"isProcessMaxNrRecipients",value:function(){var e=this.props.apiResponseView.unsafeRecipients.to.concat(this.props.apiResponseView.unsafeRecipients.cc).concat(this.props.apiResponseView.unsafeRecipients.bcc),t=!1;return e.forEach((function(e){e.tooManyRecipientsCount>0&&(t=!0)})),t}},{key:"setDialogTimeout",value:function(e){setTimeout((function(){st.info("Dialog timeout reached, closing dialog.");var e=JSON.stringify({send:!1,encrypt:!1});Office.context.ui.messageParent(e)}),1e3*e)}},{key:"attachmentPasswordRequest",value:function(){this.setState({showAttachmentPasswordPrompt:!0})}},{key:"attachmentSendPassword",value:function(){var e=Object(f.a)(m.a.mark((function e(t){var n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.setState({hasShownPassowrdPrompt:!0,showAttachmentPasswordPrompt:!1,enabledSubmitPassword:!1}),n=te.localGet(Y.SafeSendToken),e.next=4,Qe.sendAttachmentPassword(n,t);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setSendEnabled",value:function(){this.settings.denySend=this.props.contentScanningAction===u.Deny||0!==this.props.countUnprotectedAttachments&&this.props.apiResponseView.onSendProcessContex.settings._unprotectedAttachmentsMode===a.Deny,this.settings.showConfirmContentScanningCheck=this.props.contentScanningAction===u.Confirm,this.settings.showConfirmContentScanningText=this.props.contentScanningAction===u.ConfirmText,this.settings.showConfirmClientKeywordsText=this.props.clientKeywordDomainResults.length>0&&!this.props.apiResponseView.onSendProcessContex.settings._clientKeywordDisableConfirm;var e=this.settings.confirmableAllSelected&&!this.props.isDlpWaiting&&(!this.isBccWarningVisible()||this.settings.bccWarningIfMoreThanX)&&(this.props.contentScanningAction===u.Inform||this.props.contentScanningAction===u.Confirm&&this.settings.confirmContentScanningCheck||this.props.contentScanningAction===u.ConfirmText&&"confirm"===this.settings.confirmContentScanningText.toLowerCase())&&(!this.settings.showConfirmClientKeywordsText||"confirm"===this.settings.confirmClientKeywordsText.toLowerCase())&&(!this.isEncryptVisible()||this.settings.encryptYesSelected||this.settings.encryptNoSelected)&&(0===this.props.countUnprotectedAttachments||this.props.apiResponseView.onSendProcessContex.settings._unprotectedAttachmentsMode===a.Ignore||this.props.apiResponseView.onSendProcessContex.settings._unprotectedAttachmentsMode===a.Notify||this.props.apiResponseView.onSendProcessContex.settings._unprotectedAttachmentsMode===a.Confirm&&this.settings.confirmUnprotectedAttachmentsCheck);this.setState({enabledSend:e})}},{key:"render",value:function(){var e,t,n,s,o,a,r,c,l,p,u,d,h,g,m,f,v,y,b,S,C,W,U,H,K,z,G,q,Y,X,Z,ee,te,ne,ie,se,oe,ae,re,ce,le,pe,ue,de,he,ge,fe,ve,ye,be,Se,Ce,Re,we,ke,Ee,Te,Ae,Oe,Pe,Le,Ie,De=this;this.props.apiResponseView.onSendProcessContex&&this.setEncryptVisibility(this.props.apiResponseView.onSendProcessContex.confirmationFlags.showEncryptPrompt);var Ne=0===Object.entries(this.props.apiResponseView).length;return(null===(e=this.props.apiResponseView.onSendProcessContex)||void 0===e?void 0:e.settings._triggerEncryptionMode)===i.AskWhenFoundSensitiveContent&&this.props.contentScanningResults.length>0&&(st.debug("Asking to encrypt because sensitive content found"),this.setEncryptVisibility(!0)),x.createElement(x.Fragment,null,(Ne||this.state.isConnectionLost)&&x.createElement(it,null),!Ne&&!this.state.isConnectionLost&&x.createElement(T.a,{isOpen:!0,type:A.a.smallFluid,onRenderFooterContent:function(){var e,t,n;return x.createElement(F.a,{horizontal:!0,reversed:De.props.apiResponseView.alignRightToLeft,id:"child",style:{display:"flex",justifyContent:"space-between",alignItems:"flex-end"}},x.createElement(R.a,{src:"data:image/png;base64,".concat(null===(e=De.props.apiResponseView.onSendProcessContex)||void 0===e?void 0:e.settings.logoBytes),alt:"placeholder",height:48}),x.createElement(F.a,{horizontal:!0,reversed:De.props.apiResponseView.alignRightToLeft,id:"child",style:{display:"flex",justifyContent:"flex-end"}},x.createElement(w.a,{onClick:function(){return De.closeDialog({send:!0,encrypt:De.settings.encryptYesSelected,showEncryptPrompt:De.isEncryptVisible()})},text:null===(t=De.props.apiResponseView.onSendProcessContex)||void 0===t?void 0:t.settings._stringMainSendButton,disabled:!De.state.enabledSend}),x.createElement(k.a,{vertical:!0}),x.createElement(E.a,{onClick:function(){return De.closeDialog({send:!1,encrypt:!1,showEncryptPrompt:De.isEncryptVisible()})},text:null===(n=De.props.apiResponseView.onSendProcessContex)||void 0===n?void 0:n.settings._stringMainCancelButton})))},hasCloseButton:!1,headerText:this.props.apiResponseView.onSendProcessContex.confirmationFlags.mainTitle,isFooterAtBottom:!0,className:dt.content,styles:mt},x.createElement(F.a,{className:dt.content},this.isBccWarningVisible()&&x.createElement(F.a,{style:this.props.apiResponseView.alignRightToLeft?{alignItems:"flex-end",textAlign:"right"}:{alignItems:"flex-start"}},x.createElement(O.a,{boxSide:this.props.apiResponseView.alignRightToLeft?"end":"start",disabled:this.settings.denySend,label:null===(t=this.props.apiResponseView.onSendProcessContex)||void 0===t?void 0:t.settings._stringMainBCCWarning,checked:this.settings.bccWarningIfMoreThanX,onChange:function(e){De.settings.bccWarningIfMoreThanX=(null===e||void 0===e?void 0:e.target).checked,De.setSendEnabled()}})),(null===(n=this.props.apiResponseView.onSendProcessContex)||void 0===n?void 0:n.settings._showFromAddress)&&x.createElement(P.a,null,this.props.apiResponseView.fromAddress),(null===(s=this.props.apiResponseView.onSendProcessContex)||void 0===s?void 0:s.confirmationFlags.displaySubject)&&x.createElement(P.a,null,this.props.apiResponseView.subjectText),this.isEncryptVisible()&&x.createElement(F.a,{horizontal:!0,verticalAlign:"center",horizontalAlign:this.props.apiResponseView.alignRightToLeft?"end":"start",tokens:ct},x.createElement(L.a,{defaultSelectedKey:0!==(null===(o=this.props.apiResponseView.onSendProcessContex)||void 0===o?void 0:o.settings._triggerEncryptionDefaultOption)?1===(null===(a=this.props.apiResponseView.onSendProcessContex)||void 0===a?void 0:a.settings._triggerEncryptionDefaultOption)?this.validateEncryptionSelection("Yes",!0):this.validateEncryptionSelection("No",!0):"",styles:{flexContainer:{display:"flex"}},onChange:function(e,t){void 0!==t&&De.validateEncryptionSelection(null===t||void 0===t?void 0:t.key,!1)},label:null===(r=this.props.apiResponseView.onSendProcessContex)||void 0===r?void 0:r.settings._stringMainTriggerEncryptionQuestion,options:[{key:"Yes",text:null===(c=this.props.apiResponseView.onSendProcessContex)||void 0===c?void 0:c.settings._stringMainTriggerEncryptionOptionYes,styles:{field:{marginRight:"15px"}}},{key:"No",text:null===(l=this.props.apiResponseView.onSendProcessContex)||void 0===l?void 0:l.settings._stringMainTriggerEncryptionOptionNo}]})),this.isUnprotectedAttachmentsNotificationVisible()&&x.createElement(P.a,null,this.props.unprotectedAttachmentMessage),this.isUnprotectedAttachmentsComfirmationVisible()&&x.createElement(F.a,{style:this.props.apiResponseView.alignRightToLeft?{alignItems:"flex-end",textAlign:"right"}:{alignItems:"flex-start",paddingBottom:"2px"}},x.createElement(O.a,{boxSide:this.props.apiResponseView.alignRightToLeft?"end":"start",disabled:this.settings.denySend,label:this.props.unprotectedAttachmentMessage,checked:this.settings.confirmUnprotectedAttachmentsCheck,onChange:function(e){De.settings.confirmUnprotectedAttachmentsCheck=(null===e||void 0===e?void 0:e.target).checked,De.setSendEnabled()}})),this.props.confirmationRequired&&x.createElement("div",{className:dt.wrapper,style:ze.browserName===J.Safari||ze.browserName===J.WebKit?{height:"250px"}:{}},x.createElement(I.a,{scrollContainerFocus:!0,scrollContainerAriaLabel:"Sticky component example",styles:gt},x.createElement("div",null,x.createElement(D.a,{stickyPosition:N.a.Both},x.createElement("div",{role:"heading","aria-level":0,className:dt.sticky},this.props.apiResponseView.unsafeRecipients.isGroupByDomain&&x.createElement(V.a,{messageBarType:j.a.warning,isMultiline:!1,styles:this.props.apiResponseView.alignRightToLeft?lt:{}},this.isProcessMaxNrRecipients()?x.createElement("div",{dangerouslySetInnerHTML:{__html:$(null===(p=this.props.apiResponseView.onSendProcessContex)||void 0===p?void 0:p.settings._stringMainMessageManyRecipients)}}):this.props.apiResponseView.unsafeRecipients.toGroup.length>1||this.props.apiResponseView.unsafeRecipients.ccGroup.length>1||this.props.apiResponseView.unsafeRecipients.bccGroup.length>1?x.createElement("div",{dangerouslySetInnerHTML:{__html:$(null===(u=this.props.apiResponseView.onSendProcessContex)||void 0===u?void 0:u.settings._stringMainMessageMultipleDomainRecipients)}}):x.createElement("div",{dangerouslySetInnerHTML:{__html:$(null===(d=this.props.apiResponseView.onSendProcessContex)||void 0===d?void 0:d.settings._stringMainMessageSingleDomainRecipient)}})),!this.props.apiResponseView.unsafeRecipients.isGroupByDomain&&x.createElement(V.a,{messageBarType:j.a.warning,isMultiline:this.isProcessMaxNrRecipients(),styles:this.props.apiResponseView.alignRightToLeft?lt:{}},this.isProcessMaxNrRecipients()?x.createElement("div",{dangerouslySetInnerHTML:{__html:$(null===(h=this.props.apiResponseView.onSendProcessContex)||void 0===h?void 0:h.settings._stringMainMessageManyRecipients)}}):this.props.apiResponseView.unsafeRecipientsCount>1?x.createElement("div",{dangerouslySetInnerHTML:{__html:$(null===(g=this.props.apiResponseView.onSendProcessContex)||void 0===g?void 0:g.settings._stringMainMessageMultipleRecipients)}}):x.createElement("div",{dangerouslySetInnerHTML:{__html:$(null===(m=this.props.apiResponseView.onSendProcessContex)||void 0===m?void 0:m.settings._stringMainMessageSingleRecipient)}})),this.props.apiResponseView.unsafeAttachmentsCount>0&&x.createElement(V.a,{messageBarType:j.a.severeWarning,isMultiline:!1,styles:this.props.apiResponseView.alignRightToLeft?lt:{}},(null===(f=this.props.apiResponseView.onSendProcessContex)||void 0===f?void 0:f.settings._disableConfirmAttachments)?null===(v=this.props.apiResponseView.onSendProcessContex)||void 0===v?void 0:v.settings._stringMainFilesAttached:this.props.apiResponseView.unsafeAttachmentsCount>1?null===(y=this.props.apiResponseView.onSendProcessContex)||void 0===y?void 0:y.settings._stringMainFilesAttachedConfirmed:null===(b=this.props.apiResponseView.onSendProcessContex)||void 0===b?void 0:b.settings._stringMainFileAttachedConfirmed))),x.createElement(F.a,{tokens:pt},x.createElement(Ke,{onChange:function(e){De.settings.confirmableAllSelected=e,De.setSendEnabled()},apiResponse:this.props.apiResponseView,denySend:this.settings.denySend,scanTimedOut:this.props.scanTimedOut,dlps:this.props.dlps,alignRightToLeft:this.props.apiResponseView.alignRightToLeft}))),x.createElement("div",null,x.createElement(D.a,{stickyPosition:N.a.Both},x.createElement("div",{role:"heading","aria-level":1,className:0===this.props.clientKeywordDomainResults.length?"hidden":dt.sticky},x.createElement(V.a,{messageBarType:j.a.severeWarning,isMultiline:!1,styles:this.props.apiResponseView.alignRightToLeft?lt:{}},x.createElement(F.a,null,!this.props.scanTimedOut&&!this.settings.denySend&&x.createElement(x.Fragment,null,null===(S=this.props.apiResponseView.onSendProcessContex)||void 0===S?void 0:S.settings._stringContentScanningWrongClientWarning),this.props.scanTimedOut&&this.settings.denySend&&x.createElement(x.Fragment,null,null===(C=this.props.apiResponseView.onSendProcessContex)||void 0===C?void 0:C.settings._stringContentScanningWrongClientWarning," - ",null===(W=this.props.apiResponseView.onSendProcessContex)||void 0===W?void 0:W.settings._stringContentScanningTimedOutShort,", ",null===(U=this.props.apiResponseView.onSendProcessContex)||void 0===U?void 0:U.settings._stringContentScanningSendingNotAllowed),this.props.scanTimedOut&&!this.settings.denySend&&x.createElement(x.Fragment,null,null===(H=this.props.apiResponseView.onSendProcessContex)||void 0===H?void 0:H.settings._stringContentScanningWrongClientWarning," - ",null===(K=this.props.apiResponseView.onSendProcessContex)||void 0===K?void 0:K.settings._stringContentScanningTimedOutShort),!this.props.scanTimedOut&&this.settings.denySend&&x.createElement(x.Fragment,null,null===(z=this.props.apiResponseView.onSendProcessContex)||void 0===z?void 0:z.settings._stringContentScanningWrongClientWarning," - ",null===(G=this.props.apiResponseView.onSendProcessContex)||void 0===G?void 0:G.settings._stringContentScanningSendingNotAllowed),this.props.groupByAttachments.groupByClientKeywordAttachments&&x.createElement("span",null,this.props.groupByAttachments.groupByClientKeywordAttachmentsText))))),0!==this.props.clientKeywordDomainResults.length&&x.createElement(F.a,{tokens:pt},x.createElement(me,{confirmText:null===(q=this.props.apiResponseView.onSendProcessContex)||void 0===q?void 0:q.settings._stringContentScanningConfirmContentText,columnName1:null===(Y=this.props.apiResponseView.onSendProcessContex)||void 0===Y?void 0:Y.settings._stringContentScanningSource,columnName2:null===(X=this.props.apiResponseView.onSendProcessContex)||void 0===X?void 0:X.settings._stringContentScanningEmailAttachment,columnName3:null===(Z=this.props.apiResponseView.onSendProcessContex)||void 0===Z?void 0:Z.settings._stringContentScanningClientData,columnName4:null===(ee=this.props.apiResponseView.onSendProcessContex)||void 0===ee?void 0:ee.settings._stringContentScanningTotalMatches,columnName5:null===(te=this.props.apiResponseView.onSendProcessContex)||void 0===te?void 0:te.settings._stringContentScanningAllowedDomains,results:this.props.clientKeywordDomainResults,showTextField:this.settings.showConfirmClientKeywordsText,denySend:this.settings.denySend,hasAttachments:(null===(ne=this.props.apiResponseView.onSendProcessContex)||void 0===ne?void 0:ne.mailItem.attachmentCount)>0,onChangeAction:function(e){De.settings.confirmClientKeywordsText=e.target.value,De.setSendEnabled()},alignRightToLeft:this.props.apiResponseView.alignRightToLeft,pointCursorText:null===(ie=this.props.apiResponseView.onSendProcessContex)||void 0===ie?void 0:ie.settings._stringContentScanningPointCursorHere,tooLongText:null===(se=this.props.apiResponseView.onSendProcessContex)||void 0===se?void 0:se.settings._stringContentScanningTooLongToDisplay}))),x.createElement("div",null,x.createElement(D.a,{stickyPosition:N.a.Both},x.createElement("div",{role:"heading","aria-level":2,className:0===this.props.contentScanningResults.length?"hidden":dt.sticky},x.createElement(V.a,{messageBarType:j.a.severeWarning,isMultiline:!1,styles:this.props.apiResponseView.alignRightToLeft?lt:{}},x.createElement(F.a,null,!this.props.scanTimedOut&&!this.settings.denySend&&x.createElement(x.Fragment,null,null===(oe=this.props.apiResponseView.onSendProcessContex)||void 0===oe?void 0:oe.settings._stringContentScanningSensitiveContentFound),this.props.scanTimedOut&&this.settings.denySend&&x.createElement(x.Fragment,null,null===(ae=this.props.apiResponseView.onSendProcessContex)||void 0===ae?void 0:ae.settings._stringContentScanningSensitiveContentFound," - ",null===(re=this.props.apiResponseView.onSendProcessContex)||void 0===re?void 0:re.settings._stringContentScanningTimedOutShort,", ",null===(ce=this.props.apiResponseView.onSendProcessContex)||void 0===ce?void 0:ce.settings._stringContentScanningSendingNotAllowed),this.props.scanTimedOut&&!this.settings.denySend&&x.createElement(x.Fragment,null,null===(le=this.props.apiResponseView.onSendProcessContex)||void 0===le?void 0:le.settings._stringContentScanningSensitiveContentFound," - ",null===(pe=this.props.apiResponseView.onSendProcessContex)||void 0===pe?void 0:pe.settings._stringContentScanningTimedOutShort),!this.props.scanTimedOut&&this.settings.denySend&&x.createElement(x.Fragment,null,null===(ue=this.props.apiResponseView.onSendProcessContex)||void 0===ue?void 0:ue.settings._stringContentScanningSensitiveContentFound," - ",null===(de=this.props.apiResponseView.onSendProcessContex)||void 0===de?void 0:de.settings._stringContentScanningSendingNotAllowed),this.props.groupByAttachments.groupByContentScanningAttachments&&x.createElement("span",null,this.props.groupByAttachments.groupByContentScanningAttachmentsText))))),0!==this.props.contentScanningResults.length&&x.createElement(F.a,{tokens:pt},x.createElement(xe,{columnName1:null===(he=this.props.apiResponseView.onSendProcessContex)||void 0===he?void 0:he.settings._stringContentScanningRule,columnName2:null===(ge=this.props.apiResponseView.onSendProcessContex)||void 0===ge?void 0:ge.settings._stringContentScanningSource,columnName3:null===(fe=this.props.apiResponseView.onSendProcessContex)||void 0===fe?void 0:fe.settings._stringContentScanningEmailAttachment,columnName4:null===(ve=this.props.apiResponseView.onSendProcessContex)||void 0===ve?void 0:ve.settings._stringContentScanningFirstMatch,columnName5:null===(ye=this.props.apiResponseView.onSendProcessContex)||void 0===ye?void 0:ye.settings._stringContentScanningTotalMatches,showCheckbox:this.settings.showConfirmContentScanningCheck,showTextField:this.settings.showConfirmContentScanningText,labelCheckbox:null===(be=this.props.apiResponseView.onSendProcessContex)||void 0===be?void 0:be.settings._stringContentScanningConfirmContent,labelTextField:null===(Se=this.props.apiResponseView.onSendProcessContex)||void 0===Se?void 0:Se.settings._stringContentScanningConfirmContentText,checkboxChecked:this.settings.confirmContentScanningCheck,results:this.props.contentScanningResults,denySend:this.settings.denySend,hasAttachments:(null===(Ce=this.props.apiResponseView.onSendProcessContex)||void 0===Ce?void 0:Ce.mailItem.attachmentCount)>0,onChangeCheckbox:function(e){De.settings.confirmContentScanningCheck=(null===e||void 0===e?void 0:e.target).checked,De.setSendEnabled()},onChangeTextField:function(e){De.settings.confirmContentScanningText=e.target.value,De.setSendEnabled()},alignRightToLeft:this.props.apiResponseView.alignRightToLeft,pointCursorText:null===(Re=this.props.apiResponseView.onSendProcessContex)||void 0===Re?void 0:Re.settings._stringContentScanningPointCursorHere,tooLongText:null===(we=this.props.apiResponseView.onSendProcessContex)||void 0===we?void 0:we.settings._stringContentScanningTooLongToDisplay}))))),this.isPasswordPromptVisible()&&x.createElement(F.a,{horizontal:!0,reversed:this.props.apiResponseView.alignRightToLeft,styles:at,tokens:rt},x.createElement(P.a,null,null===(ke=this.props.apiResponseView.onSendProcessContex)||void 0===ke?void 0:ke.settings._stringPasswordRequired),x.createElement(M.a,{required:!0,type:"password",autoComplete:"off",styles:ot,autoFocus:!0,onChange:function(e){De.settings.attachmentPassword=e.target.value,""!==De.settings.attachmentPassword?De.setState({enabledSubmitPassword:!0}):De.setState({enabledSubmitPassword:!1})},onKeyDown:function(e){var t=e;"Enter"===t.key&&(t.preventDefault(),t.stopPropagation(),De.attachmentSendPassword(De.settings.attachmentPassword))}}),x.createElement(w.a,{onClick:function(){return De.attachmentSendPassword(De.settings.attachmentPassword)},text:null===(Ee=this.props.apiResponseView.onSendProcessContex)||void 0===Ee?void 0:Ee.settings._stringPasswordSubmit,disabled:!this.state.enabledSubmitPassword})),x.createElement(F.a,{reversed:this.props.apiResponseView.alignRightToLeft,className:dt.notificationArea,tokens:ht},this.props.apiResponseView.onSendProcessContex.scanStarted&&this.props.isDlpWaiting&&x.createElement("div",{className:dt.progressIndicator,style:this.props.apiResponseView.alignRightToLeft?{textAlign:"right"}:{textAlign:"left"}},x.createElement(_.a,{label:null===(Te=this.props.apiResponseView.onSendProcessContex)||void 0===Te?void 0:Te.settings._stringContentScanningScanningContent,className:dt.progressIndicator})),this.props.apiResponseView.onSendProcessContex.scanStarted&&!this.props.isDlpWaiting&&!this.props.scanTimedOut&&0===this.props.clientKeywordDomainResults.length&&0===this.props.contentScanningResults.length&&x.createElement(F.a,{horizontal:!0,reversed:this.props.apiResponseView.alignRightToLeft},x.createElement(P.a,null,null===(Ae=this.props.apiResponseView.onSendProcessContex)||void 0===Ae?void 0:Ae.settings._stringContentScanningComplete),x.createElement(B.a,{iconName:"CompletedSolid",className:dt.completed})),this.props.apiResponseView.onSendProcessContex.scanStarted&&!this.props.isDlpWaiting&&this.props.scanTimedOut&&0===this.props.clientKeywordDomainResults.length&&0===this.props.contentScanningResults.length&&x.createElement(F.a,{horizontal:!0,reversed:this.props.apiResponseView.alignRightToLeft},x.createElement(P.a,null,null===(Oe=this.props.apiResponseView.onSendProcessContex)||void 0===Oe?void 0:Oe.settings._stringContentScanningTimedOutLong),x.createElement(B.a,{iconName:"WarningSolid",className:dt.warning})),(null===(Pe=this.props.apiResponseView.onSendProcessContex)||void 0===Pe?void 0:Pe.confirmationFlags.showPolicyText)&&x.createElement("div",{style:{fontSize:"11px"},dangerouslySetInnerHTML:{__html:$(Q("%",null===(Le=this.props.apiResponseView.onSendProcessContex)||void 0===Le?void 0:Le.settings._stringMainPolicy,null===(Ie=this.props.apiResponseView.onSendProcessContex)||void 0===Ie?void 0:Ie.settings._policyLink))}})))))}}]),n}(x.Component),vt=new(function(){function e(){Object(v.a)(this,e)}return Object(y.a)(e,[{key:"getGroupAttachment",value:function(e,t){var n=[],i={};for(var s in e.forEach((function(e){if(e.sourceType===p.Attachment){var s=t?e.firstMatch:e.clientKeyword,o=i[s];o?(o.matchCount+=e.matchCount,o.files.push(e.attachmentPath)):(e.files.push(e.attachmentPath),e.groupBy=!0,i[s]=e)}else n.push(e)})),i){var o=i[s],a=o.files.filter((function(e,t,n){return t===n.indexOf(e)}));o.files=a;var r=o.files.join().length;o.tooLong=!1,r>60?r<=5e3?o.useTooltip=!0:(o.tooLong=!0,o.files=[]):o.useTooltip=!1,o.files=o.files.sort((function(e,t){return e>t?1:-1})),n.push(o)}return n}},{key:"getContentScanningAction",value:function(e,t){switch(e){case u.Confirm:if(t===u.Inform)return e;break;case u.ConfirmText:if(t===u.Inform||t===u.Confirm)return e;break;case u.Deny:return e}return t}},{key:"getStateForUpdateUI",value:function(e,t,n,i,s,o,r,c,l,p){var u=this,d=[];r.forEach((function(s){var o=u.getProcessedContentScanningResults(e,i,s.contentScanResults);i=o.actionOnMatch,n=n.concat(o.contentScanningResultView);var a=u.getProcessedClientKeywordDomainResults(e,s.clientKeywordDomainResults);t=t.concat(a),s.isAttachment&&(d.push({id:s.id,status:s.status,statusString:s.statusString}),s.containsUnprotectedAttachment&&p++)}));var h="";if(1===p)switch(e._unprotectedAttachmentsMode){case a.Confirm:h=e._stringNotEncryptedAttachmentConfirm;break;case a.Deny:h=e._stringNotEncryptedAttachmentDeny;break;default:h=e._stringNotEncryptedAttachmentNotify}else switch(e._unprotectedAttachmentsMode){case a.Confirm:h=e._stringNotEncryptedAttachmentsConfirm;break;case a.Deny:h=e._stringNotEncryptedAttachmentsDeny;break;default:h=e._stringNotEncryptedAttachmentsNotify}return s&&(t=this.getGroupAttachment(t,!1)),o&&(n=this.getGroupAttachment(n,!0)),t=this.copyAndSort(t,"".concat(q((function(e){return e.attachmentPath}))),!1),n=this.copyAndSort(n,"".concat(q((function(e){return e.attachmentPath}))),!1),{isDlpWaiting:c,scanTimedOut:l,clientKeywordDomainResults:t,contentScanningResults:n,contentScanningAction:i,dlps:d,countUnprotectedAttachments:p,unprotectedAttachmentMessage:h}}},{key:"copyAndSort",value:function(e,t,n){var i=t;return e.slice(0).sort((function(e,t){return(n?e[i]<t[i]:e[i]>t[i])?1:-1}))}},{key:"getProcessedClientKeywordDomainResults",value:function(e,t){return t.forEach((function(t){switch(t.sourceType){case p.Attachment:t.sourceTypeString=e._stringContentScanningEmailAttachment;break;case p.Body:t.sourceTypeString=e._stringContentScanningEmailContent;break;case p.Filename:t.sourceTypeString=e._stringContentScanningEmailFileName;break;case p.Subject:t.sourceTypeString=e._stringContentScanningEmailSubject}})),t}},{key:"getProcessedContentScanningResults",value:function(e,t,n){var i=this;return n.forEach((function(n){switch(t=i.getContentScanningAction(t,n.actionOnMatch),n.sourceType){case p.Attachment:n.sourceTypeString=e._stringContentScanningEmailAttachment;break;case p.Body:n.sourceTypeString=e._stringContentScanningEmailContent;break;case p.Filename:n.sourceTypeString=e._stringContentScanningEmailFileName;break;case p.Subject:n.sourceTypeString=e._stringContentScanningEmailSubject}})),{contentScanningResultView:n,actionOnMatch:t}}},{key:"getGroupByAttachments",value:function(e,t,n){return n.forEach((function(e){e.isAttachment&&t.countTotalAttachmentsScanned++,t.countTotalClientKeyword+=e.clientKeywordDomainResults.length,e.clientKeywordDomainResults.forEach((function(e){t.countTotalClientKeywordMatches+=e.matchCount})),t.countTotalContentScanning+=e.contentScanResults.length,e.contentScanResults.forEach((function(e){t.countTotalContentScanningMatches+=e.matchCount}))})),t.groupByClientKeywordAttachments=!!t.groupByClientKeywordAttachments||t.countTotalClientKeyword>e._contentScanningMaxNrMatchesBeforeTryingToGroupByAttachment,t.groupByContentScanningAttachments=!!t.groupByContentScanningAttachments||t.countTotalContentScanning>e._contentScanningMaxNrMatchesBeforeTryingToGroupByAttachment,t.groupByClientKeywordAttachments&&(t.groupByClientKeywordAttachmentsText=Z(e._stringContentScanningTooManyMatches,"".concat(t.countTotalClientKeywordMatches),"".concat(t.countTotalAttachmentsScanned))),t.groupByContentScanningAttachments&&(t.groupByContentScanningAttachmentsText=Z(e._stringContentScanningTooManyMatches,"".concat(t.countTotalContentScanningMatches),"".concat(t.countTotalAttachmentsScanned))),t}}]),e}()),yt=je.getLogger(ee.SafeSend_OfficeDialog),bt={padding:"0px 0px 0px 50px"},St=function(e){Object(S.a)(n,e);var t=Object(C.a)(n);function n(e,i){var s;return Object(v.a)(this,n),(s=t.call(this,e,i)).sendEvent=void 0,s.state={isConnectionLost:!1},s.closeDialog=s.closeDialog.bind(Object(b.a)(s)),s}return Object(y.a)(n,[{key:"componentDidMount",value:function(){var e=this;this.setDialogTimeout(240),window.addEventListener("storage",(function(){var t=te.localGet(Y.DialogId);e.props.dialogId!==t&&e.setState({isConnectionLost:!0})}))}},{key:"closeDialog",value:function(){var e=JSON.stringify({send:!1,encrypt:!1});Office.context.ui.messageParent(e)}},{key:"setDialogTimeout",value:function(e){setTimeout((function(){yt.info("Dialog timeout reached, closing dialog."),Office.context.ui.messageParent(JSON.stringify({send:!1,encrypt:!1}))}),1e3*e)}},{key:"render",value:function(){for(var e,t=this,n=[],i=0;i++;i<this.props.apiResponseView.onSendProcessContex.forbiddenRecipients.length&&i<10){var s=this.props.apiResponseView.onSendProcessContex.forbiddenRecipients[i],o=s.name+(s.isList?" ("+this.props.apiResponseView.onSendProcessContex.settings._stringMainListIdentifier+")":"");n.push(o)}return x.createElement(x.Fragment,null,this.state.isConnectionLost&&x.createElement(it,null),!this.state.isConnectionLost&&x.createElement(T.a,{isOpen:!0,type:A.a.smallFluid,onRenderFooterContent:function(){var e;return x.createElement(F.a,{horizontal:!0,reversed:t.props.apiResponseView.alignRightToLeft,id:"child",style:{display:"flex",justifyContent:"space-between",alignItems:"flex-end"}},x.createElement(F.a,null),x.createElement(F.a,{horizontal:!0,reversed:t.props.apiResponseView.alignRightToLeft,id:"child",style:{display:"flex",justifyContent:"flex-end"}},x.createElement(k.a,{vertical:!0}),x.createElement(E.a,{onClick:function(){return t.closeDialog()},text:null===(e=t.props.apiResponseView.onSendProcessContex)||void 0===e?void 0:e.settings._stringMainCancelButton})))},hasCloseButton:!1,headerText:null===(e=this.props.apiResponseView.onSendProcessContex.confirmationFlags)||void 0===e?void 0:e.mainTitle,isFooterAtBottom:!0},x.createElement(P.a,null,this.props.apiResponseView.onSendProcessContex.settings._stringForbiddenRecipientTitle),1===this.props.apiResponseView.onSendProcessContex.forbiddenRecipients.length&&x.createElement(P.a,null,this.props.apiResponseView.onSendProcessContex.settings._stringForbiddenRecipient),1!==this.props.apiResponseView.onSendProcessContex.forbiddenRecipients.length&&x.createElement(P.a,null,this.props.apiResponseView.onSendProcessContex.settings._stringForbiddenRecipients),x.createElement(F.a,{tokens:bt},this.props.apiResponseView.onSendProcessContex.forbiddenRecipients.slice(0,10).map((function(e,n){return x.createElement(P.a,{key:n},e.name+(e.isList?" (".concat(t.props.apiResponseView.onSendProcessContex.settings._stringMainListIdentifier,")"):""))})),this.props.apiResponseView.onSendProcessContex.forbiddenRecipients.length>10&&x.createElement(P.a,null,"..."))))}}]),n}(x.Component),Ct=Object(W.C)({mainSpinner:{width:"100px",height:"100px"},box:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"}}),xt=function(e){Object(S.a)(n,e);var t=Object(C.a)(n);function n(){return Object(v.a)(this,n),t.apply(this,arguments)}return Object(y.a)(n,[{key:"render",value:function(){return x.createElement(x.Fragment,null,x.createElement(F.a,{className:Ct.box},x.createElement("div",{className:"ms-BrandIcon--icon48 ms-BrandIcon--outlook"}),x.createElement(Re.a,{size:we.a.large,className:Ct.mainSpinner}),x.createElement(ie.a,{variant:"medium",block:!0},this.props.message)))}}]),n}(x.Component),Rt=n(309),wt=n(303),kt=n(307),Et=new(function(){function e(){Object(v.a)(this,e)}return Object(y.a)(e,[{key:"infoReplace",value:function(e,t,n){null===e||void 0===e||e.notificationMessages.replaceAsync(t,this.getJsonMessage(Office.MailboxEnums.ItemNotificationMessageType.InformationalMessage,n))}},{key:"errorReplace",value:function(e,t,n){null===e||void 0===e||e.notificationMessages.replaceAsync(t,this.getJsonMessage(Office.MailboxEnums.ItemNotificationMessageType.ErrorMessage,n))}},{key:"progressReplace",value:function(e,t,n){null===e||void 0===e||e.notificationMessages.replaceAsync(t,this.getJsonMessage(Office.MailboxEnums.ItemNotificationMessageType.ProgressIndicator,n))}},{key:"remove",value:function(e,t){null===e||void 0===e||e.notificationMessages.removeAsync(t)}},{key:"getJsonMessage",value:function(e,t){return e===Office.MailboxEnums.ItemNotificationMessageType.InformationalMessage?{type:e,message:"".concat("SafeSend:"," ").concat(t),icon:"iconid",persistent:!1}:{type:e,message:"".concat("SafeSend:"," ").concat(t)}}}]),e}());!function(e){e[e.Failed=0]="Failed",e[e.Succeeded=1]="Succeeded"}(Ze||(Ze={}));var Tt,At,Ot,Pt,Lt,It=je.getLogger(ee.SafeSend_AddIn),Dt=null,Nt=null,Vt=0,jt=!1,Mt={attachmentSizeThreshold:0,enabled:!1,isOffice365:!1,retryOnServerConnectionReset:0};function _t(e,t){return new Promise((function(n,i){null===e||void 0===e||e.subject.setAsync(t,{asyncContext:{}},(function(e){e.status===Office.AsyncResultStatus.Succeeded?n():i()}))}))}function Bt(e,t,n){return new Promise((function(i,s){null===e||void 0===e||e.body.setAsync(t,{coercionType:n,asyncContext:{}},(function(e){e.status===Office.AsyncResultStatus.Succeeded?i():(It.error(JSON.stringify(e.error)),s())}))}))}function Ft(e){return Wt.apply(this,arguments)}function Wt(){return(Wt=Object(f.a)(m.a.mark((function e(t){var n,i,s,o,a,r,c;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,Pt=t,i=Math.random().toString(36).substr(2,9),te.localSet(Y.DialogId,i),It.debug("1. On-Send throwed"),e.next=7,Qe.getPlatformInfo(At.platform);case 7:if(null!=(s=e.sent).content){e.next=11;break}return It.info("responsePlatform.content is null"),e.abrupt("return");case 11:if(Mt=s.content,null===(n=Mt)||void 0===n?void 0:n.enabled){e.next=16;break}return It.info("".concat(At.platform," platform disabled")),bn(t),e.abrupt("return");case 16:return Et.infoReplace(Tt,"i1","Verifying..."),e.next=19,On(s.content.isOffice365,Tt);case 19:if(Ot=e.sent,o=!0,!s.content.isOffice365){e.next=50;break}return e.prev=22,e.next=25,Pn();case 25:Ot.outlookToken=e.sent,It.info("Authenticating..."),e.next=50;break;case 29:if(e.prev=29,e.t0=e.catch(22),It.error(JSON.stringify(e.t0)),o=!1,!te.localExists(Y.OutlookAccessToken)){e.next=49;break}if(a=te.localGet(Y.OutlookAccessToken),r=a.split("."),c=JSON.parse(atob(r[1])).exp,!(Math.round((new Date).getTime()/1e3)<c)){e.next=45;break}return It.info("Authenticating (cache)..."),Ot.outlookToken=a,e.next=43,tn();case 43:e.next=47;break;case 45:It.info("Authenticating (dialog)..."),Zt();case 47:e.next=50;break;case 49:Zt();case 50:if(!o){e.next=53;break}return e.next=53,tn();case 53:e.next=65;break;case 55:if(e.prev=55,e.t1=e.catch(0),It.error(JSON.stringify(e.t1)),!(e.t1 instanceof et)){e.next=63;break}return e.next=61,Kt();case 61:e.next=65;break;case 63:return e.next=65,Gt();case 65:case"end":return e.stop()}}),e,null,[[0,55],[22,29]])})))).apply(this,arguments)}function Ut(e,t){return Ht.apply(this,arguments)}function Ht(){return(Ht=Object(f.a)(m.a.mark((function e(t,n){var i;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=(new kt.a).withUrl(n,{accessTokenFactory:function(){return t}}).build(),e.next=3,i.start();case 3:return It.info("".concat(n," communication started")),e.abrupt("return",i);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Kt(){return zt.apply(this,arguments)}function zt(){return(zt=Object(f.a)(m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!jt){e.next=5;break}return It.info("Current workflow is restarting..."),e.abrupt("return");case 5:return jt=!0,e.next=8,Gt();case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Gt(){return qt.apply(this,arguments)}function qt(){return(qt=Object(f.a)(m.a.mark((function e(){var t;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=null!==Dt,Xt(),!(Vt<1)){e.next=20;break}e.t0=Mt.retryOnServerConnectionReset,e.next=0===e.t0?6:1===e.t0?8:2===e.t0?15:18;break;case 6:return gn(),e.abrupt("break",18);case 8:if(!t){e.next=12;break}gn(),e.next=14;break;case 12:return e.next=14,Jt();case 14:return e.abrupt("break",18);case 15:return e.next=17,Jt();case 17:return e.abrupt("break",18);case 18:e.next=21;break;case 20:gn();case 21:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Jt(){return Yt.apply(this,arguments)}function Yt(){return(Yt=Object(f.a)(m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Vt++,It.warn("Connectivity issues, retry connection attempt: (".concat(Vt," of ").concat(1,")")),Et.remove(Tt,"i1"),Et.progressReplace(Tt,"p1","We are experiencing connectivity issues. Retrying."),e.next=6,Ft(Pt);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Xt(){null!==Nt&&(Nt.close(),Nt=null),null!==Dt&&(Dt.close(),Dt=null)}function Zt(){Office.context.ui.displayDialogAsync("".concat(window.location.origin,"/login"),{height:60,width:30},Qt)}function Qt(e){if(e.status===Office.AsyncResultStatus.Failed){switch(e.error.code){case 12004:It.info("Domain is not trusted");break;case 12005:It.info("HTTPS is required");break;case 12007:It.info("A dialog is already opened.");break;default:It.error(e.error.message)}Et.remove(Tt,"i1"),Et.errorReplace(Tt,"e1","Unable to successfully authenticate user"),bn(Pt,!1)}else(Nt=e.value).addEventHandler(Office.EventType.DialogMessageReceived,$t),Nt.addEventHandler(Office.EventType.DialogEventReceived,$t)}function $t(e){return en.apply(this,arguments)}function en(){return(en=Object(f.a)(m.a.mark((function e(t){var n,i,s;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null===(n=Nt)||void 0===n||n.close(),i=t.error,e.t0=t.error,e.next=12002===e.t0?5:12003===e.t0?7:12006===e.t0?9:11;break;case 5:return It.warn("Cannot load URL, no such page or bad URL syntax."),e.abrupt("break",12);case 7:return It.warn("HTTPS is required."),e.abrupt("break",12);case 9:return It.info("Dialog closed by user"),e.abrupt("break",12);case 11:return e.abrupt("break",12);case 12:if(!i){e.next=18;break}Et.remove(Tt,"i1"),Et.errorReplace(Tt,"e1","Unable to successfully authenticate user"),bn(Pt,!1),e.next=30;break;case 18:if((s=JSON.parse(t.message)).status!==Ze.Succeeded){e.next=26;break}return Ot.outlookToken=s.accessToken,te.localSet(Y.OutlookAccessToken,Ot.outlookToken),e.next=24,tn();case 24:e.next=30;break;case 26:It.error(s.error),Et.remove(Tt,"i1"),Et.errorReplace(Tt,"e1","Unable to successfully authenticate user"),bn(Pt,!1);case 30:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function tn(){return nn.apply(this,arguments)}function nn(){return(nn=Object(f.a)(m.a.mark((function e(){var t,n,i,s,o;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,vn(Pt,Ot.outlookToken);case 2:if(null!=(t=e.sent)){e.next=5;break}return e.abrupt("return");case 5:return n=Sn("1.8"),e.next=8,mn(Ot.itemId,n,At.platform);case 8:if(i=e.sent,!(n&&t.isDlpLicenseValid&&null!==i.attachments&&i.attachments.length>0)){e.next=22;break}return e.prev=10,e.next=13,Ut(t.token,X.AddinHub);case 13:return s=e.sent,i.connectionAddInId=s.connectionId,e.next=17,hn(Tt,t.token,s);case 17:e.next=22;break;case 19:throw e.prev=19,e.t0=e.catch(10),new $e("".concat(X.AddinHub," error: ").concat(JSON.stringify(e.t0)));case 22:return e.next=24,Qe.processMail(t.token,i);case 24:if(null!==(o=e.sent).content){e.next=28;break}return bn(Pt),e.abrupt("return");case 28:Lt=o.content,sn(Tt,Pt,Lt,t.token);case 30:case"end":return e.stop()}}),e,null,[[10,19]])})))).apply(this,arguments)}function sn(e,t,n,i){return on.apply(this,arguments)}function on(){return(on=Object(f.a)(m.a.mark((function e(t,n,i,s){var o,a,r,c,l;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(It.debug("2. Add-In callback"),!((null===(o=i.onSendProcessContex)||void 0===o||null===(a=o.forbiddenRecipients)||void 0===a?void 0:a.length)>0)){e.next=5;break}Et.infoReplace(t,"i1","Forbidden recipients found"),e.next=12;break;case 5:if((null===(r=i.onSendProcessContex)||void 0===r?void 0:r.confirmationRequired)||(null===(c=i.onSendProcessContex)||void 0===c?void 0:c.scanStarted)&&!(null===(l=i.onSendProcessContex)||void 0===l?void 0:l.scanCompleted)){e.next=11;break}return te.localRemove(Y.ApiResponse),e.next=9,pn(t,n,s,{send:!0,encrypt:!1,showEncryptPrompt:!1});case 9:return It.info("Email sent, no unsafe items found"),e.abrupt("return");case 11:Et.infoReplace(t,"i1","External recipients found");case 12:te.localSet(Y.ApiResponse,JSON.stringify(i)),te.localSet(Y.SafeSendToken,s),It.debug("3. Show SafeSend dialog"),Office.context.ui.displayDialogAsync(window.location.origin+"/dialog",an(i),rn);case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function an(e){var t,n,i=80,s=70,o=null===(t=e.onSendProcessContex)||void 0===t||null===(n=t.forbiddenRecipients)||void 0===n?void 0:n.length;return o>0&&(i=40,s=o>10?40:3*o,s+=25),{asyncContext:e,displayInIframe:!0,height:s,promptBeforeOpen:!1,width:i}}function rn(e){if(It.debug("4. SafeSend dialog callback"),e.status===Office.AsyncResultStatus.Failed)switch(e.error.code){case 12004:It.info("Domain is not trusted");break;case 12005:It.info("HTTPS is required");break;case 12007:It.info("A dialog is already opened.");break;default:It.error(e.error.message)}else Dt=e.value,Lt=e.asyncContext,Dt.addEventHandler(Office.EventType.DialogMessageReceived,cn),Dt.addEventHandler(Office.EventType.DialogEventReceived,cn)}function cn(e){return ln.apply(this,arguments)}function ln(){return(ln=Object(f.a)(m.a.mark((function e(t){var n,i,s;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:It.debug("5. SafeSend dialog event handler"),null===(n=Dt)||void 0===n||n.close(),i=te.localGet(Y.SafeSendToken),e.t0=t.error,e.next=12002===e.t0?6:12003===e.t0?8:12006===e.t0?10:21;break;case 6:return It.warn("Cannot load URL, no such page or bad URL syntax."),e.abrupt("break",32);case 8:return It.warn("HTTPS is required."),e.abrupt("break",32);case 10:return It.info("Dialog closed by user"),e.prev=11,e.next=14,pn(Tt,Pt,i,{send:!1,encrypt:!1,showEncryptPrompt:!1});case 14:e.next=20;break;case 16:e.prev=16,e.t1=e.catch(11),It.error(JSON.stringify(e.t1)),gn();case 20:return e.abrupt("break",32);case 21:return s=JSON.parse(t.message),e.prev=22,e.next=25,pn(Tt,Pt,i,s);case 25:e.next=31;break;case 27:e.prev=27,e.t2=e.catch(22),It.error(JSON.stringify(e.t2)),gn();case 31:return e.abrupt("break",32);case 32:if(te.localRemove(Y.SafeSendToken),!Lt.onSendProcessContex.scanStarted||Lt.onSendProcessContex.scanCompleted){e.next=38;break}return e.next=36,Qe.cancelDlp(i);case 36:e.sent.isSuccessStatusCode||gn();case 38:case"end":return e.stop()}}),e,null,[[11,16],[22,27]])})))).apply(this,arguments)}function pn(e,t,n,i){return un.apply(this,arguments)}function un(){return(un=Object(f.a)(m.a.mark((function e(t,n,i,s){var o,a,r,c,l,p;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Et.remove(t,"i1"),o=dn(s),!s.send){e.next=27;break}return Et.progressReplace(t,"i1","Sending the email."),e.next=6,Qe.postProcess(i,o);case 6:if(a=e.sent,null===(r=a.content)){e.next=25;break}if(!Lt.onSendProcessContex.settings._footerEnabled||r.shouldCancelSendEvent||At.platform!==Office.PlatformType.OfficeOnline&&At.platform!==Office.PlatformType.PC){e.next=21;break}if(!Lt.onSendProcessContex.mailItem.hasHtmlBody){e.next=17;break}return(c=Lt.onSendProcessContex.mailItem.htmlBody).includes("<body>")?(r.footerText+="</body>",c=c.replace("</body>",r.footerText)):c+=r.footerText,e.next=15,Bt(t,c,Office.CoercionType.Html);case 15:e.next=21;break;case 17:return l=Lt.onSendProcessContex.mailItem.body,l+=r.footerText,e.next=21,Bt(t,l,Office.CoercionType.Text);case 21:if(null==r.subjectPrefix){e.next=24;break}return e.next=24,_t(t,"".concat(r.subjectPrefix," ").concat(Lt.onSendProcessContex.mailItem.subject));case 24:bn(n,!r.shouldCancelSendEvent);case 25:e.next=32;break;case 27:return bn(n,!1),e.next=30,Qe.postProcess(i,o);case 30:(p=e.sent).isSuccessStatusCode||It.error(p.errorMessage);case 32:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function dn(e){return{itemId:Lt.onSendProcessContex.mailItem.itemId,clientLanguage:Office.context.displayLanguage,sendConfirmed:e.send,shouldTriggerEncryption:e.encrypt,showEncryptPrompt:e.showEncryptPrompt,confirmationRequired:Lt.onSendProcessContex.confirmationRequired,hasForbiddenRecipients:Lt.onSendProcessContex.hasForbiddenRecipients,sendCanceled:Lt.onSendProcessContex.sendCanceled,mailItemType:Lt.onSendProcessContex.mailItem.itemType,hasHtmlBody:Lt.onSendProcessContex.mailItem.hasHtmlBody}}function hn(e,t,n){n.onclose(function(){var e=Object(f.a)(m.a.mark((function e(t){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return It.error("".concat(X.AddinHub," error: ").concat(JSON.stringify(t))),e.next=3,Kt();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),n.on(l.ReceiveGetAttachmentContent,function(){var n=Object(f.a)(m.a.mark((function n(i){return m.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return It.debug("".concat(l.ReceiveGetAttachmentContent,' "').concat(i.name,'"')),n.next=3,An(e,i);case 3:return i=n.sent,n.next=6,Qe.sendAttachmentContent(t,i);case 6:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}())}function gn(){var e="We are experiencing connectivity issues. Sending the email.";It.error(e),Et.remove(Tt,"i1"),Et.remove(Tt,"p1"),Et.errorReplace(Tt,"e1",e),setTimeout((function(){bn(Pt,!0)}),3e3)}function mn(e,t,n){return fn.apply(this,arguments)}function fn(){return(fn=Object(f.a)(m.a.mark((function e(t,n,i){var s,o,a,c,l,p,u,d,h,g,f,v,y;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Et.infoReplace(Tt,"i1","Validating email..."),a={itemId:t,itemType:null===(s=Tt)||void 0===s?void 0:s.itemType,subject:null,bodyType:"",body:null,toEmails:[],ccEmails:[],bccEmails:[],attachments:null,clientLanguage:Office.context.displayLanguage,platformType:i,connectionAddInId:"",isClientSideGetAttachmentSupported:n},c=Cn(Tt,r.TO),l=Cn(Tt,r.CC),null===(p=Cn(Tt,r.BCC))){e.next=9;break}return e.next=8,xn(p,r.BCC);case 8:a.bccEmails=e.sent;case 9:if(!n){e.next=13;break}return e.next=12,Tn(Tt);case 12:a.attachments=e.sent;case 13:return e.next=15,wn(Tt);case 15:return a.bodyType=e.sent,e.next=18,Promise.all([xn(c,r.TO),xn(l,r.CC),Rn(Tt),En(Tt,a.bodyType)]);case 18:return u=e.sent,d=Object(Rt.a)(u,4),h=d[0],g=d[1],f=d[2],v=d[3],a.toEmails=h,a.ccEmails=g,a.subject=f,a.body=v,y=kn(a.body),a.attachments=null===(o=a.attachments)||void 0===o?void 0:o.concat(y),e.abrupt("return",a);case 31:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function vn(e,t){return yn.apply(this,arguments)}function yn(){return(yn=Object(f.a)(m.a.mark((function e(t,n){var i,s,a;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Qe.login(n);case 3:return s=e.sent,e.abrupt("return",s.content);case 7:if(e.prev=7,e.t0=e.catch(0),It.error(JSON.stringify(e.t0)),!(e.t0 instanceof et)){e.next=24;break}a=e.t0,e.t1=null===(i=a.response)||void 0===i?void 0:i.data.licenseKeyStatus,e.next=e.t1===o.Invalid?15:e.t1===o.TrialExpired?17:e.t1===o.LicenseExpired?19:21;break;case 15:return Et.errorReplace(Tt,"i1","Invalid license"),e.abrupt("break",21);case 17:return Et.errorReplace(Tt,"i1","Expired trial license"),e.abrupt("break",21);case 19:return Et.errorReplace(Tt,"i1","Expired license"),e.abrupt("break",21);case 21:setTimeout((function(){bn(t)}),2e3),e.next=25;break;case 24:throw e.t0;case 25:return e.abrupt("return",null);case 26:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}function bn(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];e.completed({allowEvent:t})}function Sn(e){var t=Office.context.requirements.isSetSupported("Mailbox",e);return It.info("Set ".concat(e," ").concat(t?"is supported":"is NOT supported")),t}function Cn(e,t){switch(t){case r.TO:return(null===e||void 0===e?void 0:e.itemType)===Office.MailboxEnums.ItemType.Message?e.to:null===e||void 0===e?void 0:e.requiredAttendees;case r.CC:return(null===e||void 0===e?void 0:e.itemType)===Office.MailboxEnums.ItemType.Message?e.cc:null===e||void 0===e?void 0:e.optionalAttendees;case r.BCC:return(null===e||void 0===e?void 0:e.itemType)===Office.MailboxEnums.ItemType.Message?e.bcc:null}}function xn(e,t){return new Promise((function(n,i){e.getAsync((function(e){if(e.status===Office.AsyncResultStatus.Succeeded){var s=e.value.map((function(e){return{id:0,emailAddress:e.emailAddress,name:e.displayName,isAddressTypeSupported:!1,isExchangeDistributionList:e.recipientType===Office.MailboxEnums.RecipientType.DistributionList,isOutlookDistributionList:!1,members:[],sendable:!0,sendType:t}}));n(s)}else i(e.error.message)}))}))}function Rn(e){return new Promise((function(t,n){null===e||void 0===e||e.subject.getAsync((function(e){e.status===Office.AsyncResultStatus.Succeeded?t(e.value):n(e.error.message)}))}))}function wn(e){return new Promise((function(t,n){null===e||void 0===e||e.body.getTypeAsync({asyncContext:null},(function(e){e.status===Office.AsyncResultStatus.Succeeded?t(e.value):n(e.error.message)}))}))}function kn(e){var t=document.createElement("html");t.innerHTML=e;var n=t.getElementsByTagName("img"),i=[];if(null!==n)for(var s=0;s<n.length;s++){var o,a=null===(o=n[s].attributes.getNamedItem("data-custom"))||void 0===o?void 0:o.value;if(a){var r,c=(s<10?"000":s<100?"00":s<1e3?"0":"")+s+"."+n[s].src.split(",")[0].replace("data:image/","").split(";")[0],l=n[s].src.split(",")[1],p=null===(r=n[s].attributes.getNamedItem("size"))||void 0===r?void 0:r.value,u=parseInt("undefined"!==p?p:"0");i.push({id:Office.context.mailbox.convertToRestId(a,Office.MailboxEnums.RestVersion.v2_0),jsId:a,name:c,attachmentType:"Embedded",contentBytes:l,contentType:"",isInline:!0,size:u})}}return i}function En(e,t){return new Promise((function(n,i){null===e||void 0===e||e.body.getAsync(t,{asyncContext:null},(function(e){e.status===Office.AsyncResultStatus.Succeeded?n(e.value):i(e.error.message)}))}))}function Tn(e){return new Promise((function(t){null===e||void 0===e||e.getAttachmentsAsync({},(function(e){if(e.status===Office.AsyncResultStatus.Succeeded){var n=e.value.map((function(e){return{id:Office.context.mailbox.convertToRestId(e.id,Office.MailboxEnums.RestVersion.v2_0),jsId:e.id,name:e.name.includes(".")||e.attachmentType!==Office.MailboxEnums.AttachmentType.Item?e.name:"".concat(e.name,".eml"),isInline:e.isInline,size:e.size,attachmentType:e.attachmentType,contentBytes:null,contentType:""}}));t(n)}else{var i;It.error(null===e||void 0===e||null===(i=e.error)||void 0===i?void 0:i.message),t([])}}))}))}function An(e,t){return new Promise((function(n){null===e||void 0===e||e.getAttachmentContentAsync(t.jsId,{},(function(e){if(e.status===Office.AsyncResultStatus.Succeeded){var i,s=!0,o=!1,a=Object(wt.a)(e.value.content);try{for(a.s();!(i=a.n()).done;){var r=i.value;if("="===r&&(o=!0),(o||!("+"===r||"/"<=r&&r<="9"||"a"<=r&&r<="z"||"A"<=r&&r<="Z"))&&"="!==r){s=!1,It.info("Found non-b64 character "+r);break}}}catch(c){a.e(c)}finally{a.f()}s?t.contentBytes=e.value.content:(t.contentBytes=btoa(e.value.content),"item"===t.attachmentType&&(t.name+=".eml")),n(t)}else It.error("getAttachmentContentAsync error: "+e.error.message),n(t)}))}))}function On(e,t){return new Promise((function(n,i){null===t||void 0===t||t.saveAsync(function(){var t=Object(f.a)(m.a.mark((function t(s){var o,a,r;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:o=s.value,a=Office.context.mailbox.convertToRestId(o,Office.MailboxEnums.RestVersion.v2_0),r={itemId:a,outlookToken:""},e?n(r):Office.context.mailbox.getCallbackTokenAsync({isRest:!0},(function(e){e.status===Office.AsyncResultStatus.Succeeded?(r.outlookToken=e.value,n(r)):i(e.error)}));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}))}function Pn(){return new Promise(function(){var e=Object(f.a)(m.a.mark((function e(t,n){var i,s;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,i={allowSignInPrompt:!0,allowConsentPrompt:!0,forMSGraphAccess:!0},e.next=4,OfficeRuntime.auth.getAccessToken(i);case 4:s=e.sent,t(s),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),n(e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t,n){return e.apply(this,arguments)}}())}Office.onReady((function(e){void 0!==Office.context.mailbox&&(At=e,Tt=Office.context.mailbox.item,Et.infoReplace(Tt,"i1","Initialized"))}));var Ln=je.getLogger(ee.SafeSend_App),In=function(e){Object(S.a)(n,e);var t=Object(C.a)(n);function n(e,i){var s;return Object(v.a)(this,n),(s=t.call(this,e,i)).sendEvent=void 0,s.mailboxItem={},s.officeDialog=void 0,s.chunksManager={chunkSize:0,chunkProcessedCount:0,dlpItemResults:[]},s.state={dialogId:"",isOfficeInitialized:!1,apiResponseView:{},dlps:[],contentScanningResults:[],clientKeywordDomainResults:[],contentScanningAction:u.Inform,countUnprotectedAttachments:0,unprotectedAttachmentMessage:"",isDlpWaiting:!1,scanTimedOut:!1,dialogInstance:{},groupByAttachments:{countTotalAttachmentsScanned:0,countTotalClientKeyword:0,countTotalClientKeywordMatches:0,countTotalContentScanning:0,countTotalContentScanningMatches:0,groupByClientKeywordAttachments:!1,groupByClientKeywordAttachmentsText:"",groupByContentScanningAttachments:!1,groupByContentScanningAttachmentsText:""},confirmationRequired:!1},s.officeDialog={},s.configureSignalR=s.configureSignalR.bind(Object(b.a)(s)),s.updateDialogUI=s.updateDialogUI.bind(Object(b.a)(s)),s}return Object(y.a)(n,[{key:"updateDialogUI",value:function(e,t,n,i){Ln.debug("Update dialog UI");var s=vt.getGroupByAttachments(this.state.apiResponseView.onSendProcessContex.settings,this.state.groupByAttachments,e),o=vt.getStateForUpdateUI(this.state.apiResponseView.onSendProcessContex.settings,this.state.clientKeywordDomainResults,this.state.contentScanningResults,this.state.contentScanningAction,s.groupByClientKeywordAttachments,s.groupByContentScanningAttachments,e,t,n,this.state.countUnprotectedAttachments);!this.state.confirmationRequired&&i&&this.setState({confirmationRequired:i}),this.setState({isDlpWaiting:o.isDlpWaiting,scanTimedOut:o.scanTimedOut,clientKeywordDomainResults:o.clientKeywordDomainResults,contentScanningResults:o.contentScanningResults,contentScanningAction:o.contentScanningAction,dlps:o.dlps,groupByAttachments:s,countUnprotectedAttachments:o.countUnprotectedAttachments,unprotectedAttachmentMessage:o.unprotectedAttachmentMessage}),this.chunksManager.dlpItemResults=[],this.chunksManager.chunkProcessedCount=0,this.officeDialog.setSendEnabled()}},{key:"configureSignalR",value:function(){var e=Object(f.a)(m.a.mark((function e(t){var n,i=this;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Ut(t,X.UIHub);case 3:(n=e.sent).onclose(function(){var e=Object(f.a)(m.a.mark((function e(t){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Ln.error("".concat(X.UIHub," error: ").concat(JSON.stringify(t)));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),n.on(c.ReceiveDlpItemResults,(function(e,t){Ln.debug(c.ReceiveDlpItemResults),i.chunksManager.dlpItemResults.push(e),i.chunksManager.chunkProcessedCount++,i.state.confirmationRequired!==t&&(i.setState({confirmationRequired:t}),i.chunksManager.chunkProcessedCount===i.chunksManager.chunkSize&&i.updateDialogUI(i.chunksManager.dlpItemResults,!0,!1,t))})),n.on(c.ReceiveFinishingContenScanning,(function(e,t,n){Ln.debug(c.ReceiveFinishingContenScanning),i.state.confirmationRequired?i.updateDialogUI(i.chunksManager.dlpItemResults,!1,n,t):i.officeDialog.closeDialog({send:!0,encrypt:!1,showEncryptPrompt:!1})})),n.on(c.ReceiveAttachmentPasswordRequest,(function(){Ln.debug(c.ReceiveAttachmentPasswordRequest),i.officeDialog.attachmentPasswordRequest()})),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),Ln.error("".concat(X.UIHub," error: ").concat(JSON.stringify(e.t0)));case 13:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t){return e.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){var e=this;Office.onReady(function(){var t=Object(f.a)(m.a.mark((function t(n){var i,s,o,a,r,c,l,p;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null===n.host){t.next=17;break}return Ln.debug("Load data from local storage"),o=te.localGet(Y.DialogId),a=te.localGet(Y.ApiResponse),r=JSON.parse(a),te.localRemove(Y.ApiResponse),c=r.onSendProcessContex.isDlpLicenseValid&&r.onSendProcessContex.scanStarted&&!r.onSendProcessContex.scanCompleted,t.next=9,e.setState({dialogId:o,isOfficeInitialized:!0,isDlpWaiting:c,apiResponseView:r,confirmationRequired:r.onSendProcessContex.confirmationRequired});case 9:if(0!==(null===(i=r.onSendProcessContex)||void 0===i||null===(s=i.forbiddenRecipients)||void 0===s?void 0:s.length)){t.next=17;break}if(e.updateDialogUI(r.dlpScanResults,c,r.onSendProcessContex.scanTimedOut,r.onSendProcessContex.confirmationRequired),!c){t.next=17;break}return l=r.unsafeAttachmentsCount-r.dlpScanResults.length+2,e.chunksManager.chunkSize=Math.round(l/2),p=te.localGet(Y.SafeSendToken),t.next=17,e.configureSignalR(p);case 17:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},{key:"render",value:function(){var e,t,n=this;return this.state.isOfficeInitialized?(null===(e=this.state.apiResponseView.onSendProcessContex)||void 0===e||null===(t=e.forbiddenRecipients)||void 0===t?void 0:t.length)>0?x.createElement(St,{dialogId:this.state.dialogId,apiResponseView:this.state.apiResponseView}):x.createElement(ft,{onRef:function(e){return n.officeDialog=e},dialogId:this.state.dialogId,apiResponseView:this.state.apiResponseView,dlps:this.state.dlps,isDlpWaiting:this.state.isDlpWaiting,confirmationRequired:this.state.confirmationRequired,scanTimedOut:this.state.scanTimedOut,contentScanningAction:this.state.contentScanningAction,contentScanningResults:this.state.contentScanningResults.length>0?this.state.contentScanningResults.sort((function(e,t){var n,i;return(null!==(n=e.attachmentPath)&&void 0!==n?n:"").localeCompare(null!==(i=t.attachmentPath)&&void 0!==i?i:"")})):this.state.contentScanningResults,clientKeywordDomainResults:this.state.clientKeywordDomainResults.length>0?this.state.clientKeywordDomainResults.sort((function(e,t){var n,i;return(null!==(n=e.attachmentPath)&&void 0!==n?n:"").localeCompare(null!==(i=t.attachmentPath)&&void 0!==i?i:"")})):this.state.clientKeywordDomainResults,groupByAttachments:this.state.groupByAttachments,countUnprotectedAttachments:this.state.countUnprotectedAttachments,unprotectedAttachmentMessage:this.state.unprotectedAttachmentMessage}):x.createElement(xt,{message:""})}}]),n}(x.Component),Dn=n(612),Nn=n(609),Vn=n(157),jn=function(e){Object(S.a)(n,e);var t=Object(C.a)(n);function n(){return Object(v.a)(this,n),t.apply(this,arguments)}return Object(y.a)(n,[{key:"render",value:function(){var e=this.props.message;return x.createElement(x.Fragment,null,x.createElement(k.a,{style:{backgroundColor:"d83b01"},alignContent:"start",className:"ms-fontSize-s ms-fontWeight-light "},e))}}]),n}(x.Component),Mn=function(e){Object(S.a)(n,e);var t=Object(C.a)(n);function n(e){var i;return Object(v.a)(this,n),(i=t.call(this,e)).state={isWaiting:!0,appInfo:{}},i}return Object(y.a)(n,[{key:"componentDidMount",value:function(){var e=Object(f.a)(m.a.mark((function e(){var t;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Qe.getAppInfo();case 2:return t=e.sent,e.next=5,this.setState({isWaiting:!1,appInfo:null!=t.content?t.content:{}});case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){this.setState=function(){}}},{key:"render",value:function(){var e=this.state,t=e.isWaiting,n=e.appInfo;return x.createElement(x.Fragment,null,t&&x.createElement(xt,{message:"Loading..."}),!t&&x.createElement("section",{className:"ms-welcome__progress ms-u-fadeIn500"},x.createElement(jn,{message:"Welcome SafeSend"}),x.createElement("header",{className:"ms-welcome__header ms-bgColor-neutralLighter ms-u-fadeIn500"},x.createElement(ie.a,{variant:"xxLarge",block:!0},x.createElement("span",{id:"app"},n.product)," v",x.createElement("span",{id:"version"},n.version))),x.createElement("main",{className:"ms-welcome__main"},x.createElement(ie.a,{variant:"xLarge",block:!0},n.description),x.createElement("br",null),x.createElement(ie.a,{variant:"smallPlus",block:!0},n.copyright),x.createElement(k.a,{styles:{root:{width:"100%"}}}),x.createElement(ie.a,{variant:"small",block:!0},ze.osName," ",ze.osVersion," - ",ze.browserName," ",ze.fullBrowserVersion," - ",ze.engineName," ",ze.engineVersion))))}}]),n}(x.Component),_n=n(305),Bn=n(34),Fn=n(610),Wn=function(e){Object(S.a)(n,e);var t=Object(C.a)(n);function n(){return Object(v.a)(this,n),t.apply(this,arguments)}return Object(y.a)(n,[{key:"authCallback",value:function(e,t){var n={status:Ze.Failed,accessToken:"",error:null};e?(n.error=e,Office.context.ui.messageParent(JSON.stringify(n))):"id_token"===t.tokenType?te.localSet(Y.LoggedIn,"yes"):(n.status=Ze.Succeeded,n.accessToken=t.accessToken,Office.context.ui.messageParent(JSON.stringify(n)))}},{key:"componentDidMount",value:function(){var e=this;Office.onReady(function(){var t=Object(f.a)(m.a.mark((function t(n){var i,s,o,a,r;return m.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null===n.host){t.next=10;break}return i=te.localGet(Y.SafeSendToken),t.next=4,Qe.getAppSettings(i);case 4:s=t.sent,o={auth:{clientId:null!=s.content?s.content:"",authority:"https://login.microsoftonline.com/common",redirectUri:"".concat(window.location.origin,"/login"),navigateToLoginRequestUrl:!1},cache:{cacheLocation:"localStorage",storeAuthStateInCookie:!0}},a=new Fn.a(o),r={scopes:["https://graph.microsoft.com/Files.ReadWrite","https://graph.microsoft.com/Mail.ReadWrite.Shared","https://graph.microsoft.com/Calendars.ReadWrite.Shared"]},a.handleRedirectCallback(e.authCallback),"yes"===te.localGet(Y.LoggedIn)?a.acquireTokenRedirect(r):a.loginRedirect(r);case 10:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},{key:"render",value:function(){return x.createElement(xt,{message:"Authenticating..."})}}]),n}(x.Component);Object(Dn.a)(),Object(Nn.a)(),window.onSendEvent=function(e){Ft(e)};var Un=x.createElement(_n.a,null,x.createElement(Bn.c,null,x.createElement(Bn.a,{exact:!0,path:"/",component:Mn}),x.createElement(Bn.a,{exact:!0,path:"/dialog",component:In}),x.createElement(Bn.a,{exact:!0,path:"/login",component:Wn})));Vn.render(Un,document.getElementById("container"))},83:function(e){e.exports=JSON.parse('{"logLevel":"INFO","retryOptions":{"retries":3,"retryDelay":500,"retryErrorCode":200}}')}},[[327,1,2]]]);
//# sourceMappingURL=main.855e849f.chunk.js.map